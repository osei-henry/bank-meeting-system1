<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Meeting System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Google Sheets API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        /* CSS Embedded Directly in HTML */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --mustard: #FFDB58;
            --black: #000000;
            --white: #FFFFFF;
            --gray: #1a1a1a;
            --light-gray: #333333;
            --dark-gray: #0a0a0a;
            --border-color: #444444;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --info: #2196F3;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--black);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Page Transitions */
        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: block;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 100%);
        }

        .bank-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .bank-logo i {
            font-size: 4rem;
            color: var(--mustard);
            margin-bottom: 20px;
        }

        .bank-logo h1 {
            font-size: 2.5rem;
            color: var(--white);
            font-weight: 600;
        }

        .login-card {
            background-color: var(--gray);
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
        }

        .login-card h2 {
            color: var(--white);
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--white);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            background-color: var(--light-gray);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--white);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        select.form-control {
            cursor: pointer;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--mustard);
            box-shadow: 0 0 0 2px rgba(255, 219, 88, 0.2);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--mustard);
            color: var(--black);
            width: 100%;
        }

        .btn-primary:hover {
            background-color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 219, 88, 0.3);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--mustard);
            border: 1px solid var(--mustard);
        }

        .btn-secondary:hover {
            background-color: rgba(255, 219, 88, 0.1);
        }

        .btn-danger {
            background-color: var(--danger);
            color: var(--white);
        }

        .btn-success {
            background-color: var(--success);
            color: var(--white);
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--white);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Dashboard Layout */
        #dashboard-page {
            display: none; /* Hidden by default */
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: var(--dark-gray);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .bank-logo-small {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .bank-logo-small i {
            font-size: 1.8rem;
            color: var(--mustard);
        }

        .bank-logo-small h2 {
            font-size: 1.2rem;
            color: var(--white);
            font-weight: 600;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background-color: var(--gray);
            border-radius: 6px;
        }

        .admin-info i {
            color: var(--mustard);
            font-size: 1.2rem;
        }

        .admin-info span {
            font-size: 0.9rem;
            color: var(--white);
        }

        .nav-menu {
            list-style: none;
            padding: 20px 0;
            flex-grow: 1;
        }

        .nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #999;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background-color: var(--gray);
            color: var(--white);
        }

        .nav-item.active {
            background-color: var(--gray);
            color: var(--mustard);
            border-left-color: var(--mustard);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .nav-item span {
            font-weight: 500;
        }

        #logout-btn {
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            color: #ff6b6b;
        }

        #logout-btn:hover {
            color: #ff5252;
            background-color: rgba(255, 107, 107, 0.1);
        }

        /* Main Content Area */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .main-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--dark-gray);
        }

        .main-header h1 {
            font-size: 1.8rem;
            color: var(--white);
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .page-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .hidden {
            display: none !important;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--gray);
            border-radius: 10px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--mustard);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 219, 88, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-icon i {
            font-size: 1.8rem;
            color: var(--mustard);
        }

        .stat-info h3 {
            font-size: 2.2rem;
            color: var(--white);
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: #999;
            font-size: 0.95rem;
        }

        /* Content Card */
        .content-card {
            background-color: var(--gray);
            border-radius: 10px;
            padding: 25px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .content-card h3 {
            color: var(--white);
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .content-card h3 i {
            color: var(--mustard);
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background-color: var(--light-gray);
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            color: var(--white);
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            color: #ccc;
        }

        .data-table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status.active {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .status.completed {
            background-color: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }

        .status.pending {
            background-color: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }

        .status.cancelled {
            background-color: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background-color: var(--gray);
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-lg {
            max-width: 800px;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: var(--white);
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--white);
            font-size: 2rem;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: var(--mustard);
        }

        .modal-body {
            padding: 30px;
        }

        /* Form Grid */
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        /* QR Container */
        .qr-container {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        #qrcode {
            width: 200px;
            height: 200px;
            background-color: white;
            border-radius: 8px;
            padding: 10px;
        }

        .qr-info {
            flex-grow: 1;
            min-width: 300px;
        }

        .qr-info h3 {
            color: var(--white);
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .qr-info p {
            color: #999;
            margin-bottom: 20px;
        }

        .qr-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Chart Container */
        .chart-container {
            background-color: var(--gray);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            height: 300px;
            position: relative;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #999;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: var(--mustard);
            border-bottom-color: var(--mustard);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Alert Messages */
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 4px solid var(--success);
            color: #4caf50;
        }

        .alert-error {
            background-color: rgba(244, 67, 54, 0.2);
            border-left: 4px solid var(--danger);
            color: #F44336;
        }

        /* Badge */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .badge-warning {
            background-color: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }

        /* QR Registration Portal Styles */
        .registration-portal {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 100%);
        }

        .registration-card {
            background-color: var(--gray);
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
        }

        .registration-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .registration-header h2 {
            color: var(--mustard);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .registration-header p {
            color: #999;
            font-size: 1rem;
        }

        /* Meeting Info Section */
        .meeting-info {
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid var(--mustard);
        }

        .meeting-info h3 {
            color: var(--mustard);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .meeting-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ccc;
        }

        .detail-item i {
            color: var(--mustard);
            width: 20px;
        }

        /* Success Message */
        .success-message {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .success-message i {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 20px;
        }

        .success-message h3 {
            color: var(--mustard);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .success-message p {
            color: #ccc;
            margin-bottom: 20px;
        }

        .demo-notice {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 219, 88, 0.1);
            border-radius: 6px;
            border-left: 4px solid var(--mustard);
            text-align: center;
        }

        .demo-notice p {
            color: var(--mustard);
            font-size: 0.9rem;
        }

        /* Meeting Summary Cards */
        .meeting-summary-card {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--mustard);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .meeting-summary-card:hover {
            transform: translateX(5px);
            border-left-color: var(--success);
        }

        /* View Attendee Modal */
        .attendee-details-modal .modal-content {
            max-width: 500px;
        }

        .attendee-info {
            display: grid;
            gap: 15px;
        }

        .attendee-info-item {
            padding: 10px;
            background: var(--light-gray);
            border-radius: 6px;
            border-left: 4px solid var(--mustard);
        }

        .attendee-info-item label {
            display: block;
            color: var(--mustard);
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .attendee-info-item p {
            color: var(--white);
            font-size: 1rem;
        }

        /* Restricted Access Styles */
        .restricted-access {
            text-align: center;
            padding: 40px;
            background: var(--light-gray);
            border-radius: 10px;
            border: 2px solid var(--danger);
        }

        .restricted-access i {
            font-size: 3rem;
            color: var(--danger);
            margin-bottom: 20px;
        }

        .restricted-access h3 {
            color: var(--white);
            margin-bottom: 10px;
        }

        .restricted-access p {
            color: #ccc;
        }

        /* Real-time Notification */
        .real-time-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease-out;
            max-width: 350px;
            cursor: pointer;
        }

        .real-time-notification:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .real-time-notification i {
            font-size: 24px;
        }

        .real-time-notification-content {
            flex-grow: 1;
        }

        .real-time-notification-content strong {
            display: block;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .real-time-notification-content p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .real-time-notification-time {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        /* Live Registration Counter */
        .live-registration-counter {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: var(--info);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9998;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            animation: slideInRight 0.5s ease-out;
        }

        .live-registration-counter i {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Export Options Panel */
        .export-options-panel {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--mustard);
        }

        .export-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        /* Google Sheets Integration */
        .google-sheets-connect {
            background: rgba(66, 133, 244, 0.1);
            border: 1px solid rgba(66, 133, 244, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .google-sheets-connect h4 {
            color: #4285F4;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--mustard);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .nav-item span,
            .bank-logo-small h2,
            .admin-info span {
                display: none;
            }
            
            .bank-logo-small {
                justify-content: center;
            }
            
            .nav-item {
                justify-content: center;
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .qr-container {
                flex-direction: column;
                text-align: center;
            }
            
            .qr-actions {
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .registration-card {
                padding: 30px 20px;
            }
            
            .meeting-details {
                grid-template-columns: 1fr;
            }
            
            .meeting-summary-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .meeting-summary-card .btn {
                align-self: flex-end;
            }
            
            .real-time-notification,
            .live-registration-counter {
                left: 20px;
                right: 20px;
                max-width: calc(100% - 40px);
            }
            
            .export-buttons-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 30px 20px;
            }
            
            .main-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
            }
            
            .btn {
                width: 100%;
            }
            
            .modal-content {
                padding: 10px;
            }
            
            .registration-card {
                padding: 20px 15px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page (Initially Active) -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="bank-logo">
                <i class="fas fa-university"></i>
                <h1>Bank Meeting System</h1>
            </div>
            <div class="login-card">
                <h2>Admin Login</h2>
                <div id="login-alert" class="alert alert-error"></div>
                <form id="login-form">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" class="form-control" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard Page (Initially Hidden) -->
    <div id="dashboard-page" class="page">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="bank-logo-small">
                    <i class="fas fa-university"></i>
                    <h2>Bank Admin</h2>
                </div>
                <div class="admin-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="current-admin-email">ghansah.henry@myumbbank.com</span>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="meetings">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Meetings</span>
                </li>
                <li class="nav-item" data-page="attendees">
                    <i class="fas fa-users"></i>
                    <span>Attendees</span>
                </li>
                <li class="nav-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports & Export</span>
                </li>
                <li class="nav-item" data-page="departments">
                    <i class="fas fa-building"></i>
                    <span>Departments</span>
                </li>
                <li class="nav-item" data-page="admins">
                    <i class="fas fa-user-shield"></i>
                    <span>Admins</span>
                </li>
                <li class="nav-item" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="main-header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" id="create-meeting-btn">
                        <i class="fas fa-plus"></i> New Meeting
                    </button>
                    <button class="btn btn-secondary" id="backup-data-btn">
                        <i class="fas fa-save"></i> Backup All Data
                    </button>
                </div>
            </header>

            <!-- Alert Container -->
            <div id="alert-container" style="padding: 0 30px;"></div>

            <!-- Dashboard Content -->
            <div class="page-content" id="dashboard-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-meetings">0</h3>
                            <p>Active Meetings</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-attendees">0</h3>
                            <p>Total Attendees</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-departments">0</h3>
                            <p>Departments</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-admins">0</h3>
                            <p>Admins</p>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="content-card">
                        <h3><i class="fas fa-chart-line"></i> Meeting Attendance</h3>
                        <div class="chart-container">
                            <canvas id="attendanceChart"></canvas>
                        </div>
                    </div>
                    <div class="content-card">
                        <h3><i class="fas fa-chart-pie"></i> Department Distribution</h3>
                        <div class="chart-container">
                            <canvas id="departmentChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <h3><i class="fas fa-history"></i> Recent Meetings</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Meeting Title</th>
                                    <th>Date & Time</th>
                                    <th>Department</th>
                                    <th>Attendees</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recent-meetings-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meetings Content -->
            <div class="page-content hidden" id="meetings-content">
                <div class="content-card">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="active-meetings">Active Meetings</button>
                        <button class="tab-btn" data-tab="past-meetings">Past Meetings</button>
                        <button class="tab-btn" data-tab="create-meeting">Create New Meeting</button>
                    </div>
                    
                    <div class="tab-content active" id="active-meetings">
                        <h3><i class="fas fa-calendar-check"></i> Active Meetings</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Date & Time</th>
                                    <th>Department</th>
                                    <th>Location</th>
                                    <th>Attendees</th>
                                    <th>QR Code</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="active-meetings-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="past-meetings">
                        <h3><i class="fas fa-history"></i> Past Meetings</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Date & Time</th>
                                    <th>Department</th>
                                    <th>Location</th>
                                    <th>Attendees</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="past-meetings-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="create-meeting">
                        <h3><i class="fas fa-plus-circle"></i> Create New Meeting</h3>
                        <form id="create-meeting-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="meeting-title">Meeting Title *</label>
                                    <input type="text" id="meeting-title" class="form-control" placeholder="Loan Consultation" required>
                                </div>
                                <div class="form-group">
                                    <label for="meeting-department">Department *</label>
                                    <select id="meeting-department" class="form-control" required>
                                        <option value="">Select Department</option>
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="meeting-date">Date *</label>
                                    <input type="date" id="meeting-date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="meeting-time">Time *</label>
                                    <input type="time" id="meeting-time" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="meeting-location">Location *</label>
                                    <input type="text" id="meeting-location" class="form-control" placeholder="Conference Room A" required>
                                </div>
                                <div class="form-group">
                                    <label for="meeting-duration">Duration (hours) *</label>
                                    <input type="number" id="meeting-duration" class="form-control" min="0.5" max="8" step="0.5" value="1" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="meeting-description">Description</label>
                                <textarea id="meeting-description" class="form-control" rows="3" placeholder="Meeting agenda and objectives"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="meeting-max-attendees">Maximum Attendees</label>
                                <input type="number" id="meeting-max-attendees" class="form-control" min="1" max="1000" placeholder="Leave empty for unlimited">
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-calendar-plus"></i> Create Meeting
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Attendees Content -->
            <div class="page-content hidden" id="attendees-content">
                <div class="content-card">
                    <h3><i class="fas fa-users"></i> All Attendees</h3>
                    <div class="header-actions" style="margin-bottom: 20px;">
                        <button class="btn btn-success" id="export-attendees-btn">
                            <i class="fas fa-file-csv"></i> Export to CSV
                        </button>
                        <button class="btn btn-danger" id="export-pdf-btn">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                        <button class="btn btn-warning" id="export-all-meetings-btn">
                            <i class="fas fa-file-excel"></i> Export All Meetings
                        </button>
                        <button class="btn btn-primary" id="add-attendee-btn">
                            <i class="fas fa-user-plus"></i> Add Attendee
                        </button>
                    </div>
                    
                    <!-- Meeting Summary Section -->
                    <div class="content-card meetings-summary-card" style="margin-bottom: 20px;">
                        <h3><i class="fas fa-chart-bar"></i> Attendees by Meeting</h3>
                        <div id="meetings-summary">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Account No.</th>
                                <th>Meeting</th>
                                <th>Meeting Date</th>
                                <th>Department</th>
                                <th>Registration Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="attendees-table">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports & Export Content -->
            <div class="page-content hidden" id="reports-content">
                <div class="content-card">
                    <h3><i class="fas fa-chart-bar"></i> Reports & Export Center</h3>
                    
                    <div class="export-options-panel">
                        <h4><i class="fas fa-download"></i> Export Options</h4>
                        <p>Select the type of report you want to generate:</p>
                        
                        <div class="export-buttons-grid">
                            <button class="btn btn-success" id="export-attendees-full">
                                <i class="fas fa-users"></i> All Attendees (Detailed)
                            </button>
                            <button class="btn btn-warning" id="export-meetings-summary">
                                <i class="fas fa-calendar"></i> Meetings Summary
                            </button>
                            <button class="btn btn-info" id="export-departments-report">
                                <i class="fas fa-building"></i> Departments Report
                            </button>
                            <button class="btn btn-danger" id="export-pdf-report">
                                <i class="fas fa-file-pdf"></i> PDF Report
                            </button>
                            <button class="btn btn-primary" id="export-daily-report">
                                <i class="fas fa-calendar-day"></i> Daily Report
                            </button>
                            <button class="btn btn-secondary" id="export-monthly-report">
                                <i class="fas fa-calendar-alt"></i> Monthly Report
                            </button>
                        </div>
                    </div>

                    <!-- Google Sheets Integration -->
                    <div class="google-sheets-connect">
                        <h4><i class="fab fa-google"></i> Google Sheets Integration</h4>
                        <p>Export your data directly to Google Sheets:</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sheet-name">Sheet Name</label>
                                <input type="text" id="sheet-name" class="form-control" value="Bank Meeting Data" placeholder="Enter sheet name">
                            </div>
                            <div class="form-group">
                                <label for="export-type">Data Type</label>
                                <select id="export-type" class="form-control">
                                    <option value="attendees">Attendees</option>
                                    <option value="meetings">Meetings</option>
                                    <option value="departments">Departments</option>
                                    <option value="all">All Data</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="header-actions" style="margin-top: 15px;">
                            <button class="btn btn-success" id="connect-google-sheets">
                                <i class="fab fa-google"></i> Connect to Google Sheets
                            </button>
                            <button class="btn btn-primary" id="export-to-sheets">
                                <i class="fas fa-upload"></i> Export to Sheets
                            </button>
                            <button class="btn btn-secondary" id="sync-to-sheets">
                                <i class="fas fa-sync"></i> Auto Sync
                            </button>
                        </div>
                        
                        <div id="google-sheets-status" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;">
                            <!-- Status will be shown here -->
                        </div>
                    </div>

                    <!-- Scheduled Exports -->
                    <div class="content-card" style="margin-top: 20px;">
                        <h4><i class="fas fa-clock"></i> Scheduled Exports</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="schedule-frequency">Schedule Frequency</label>
                                <select id="schedule-frequency" class="form-control">
                                    <option value="daily">Daily (5 PM)</option>
                                    <option value="weekly">Weekly (Monday 9 AM)</option>
                                    <option value="monthly">Monthly (1st of Month)</option>
                                    <option value="manual">Manual Only</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="schedule-type">Export Type</label>
                                <select id="schedule-type" class="form-control">
                                    <option value="attendees">Attendees</option>
                                    <option value="meetings">Meetings & Attendees</option>
                                    <option value="summary">Summary Report</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="save-schedule">
                            <i class="fas fa-save"></i> Save Schedule
                        </button>
                        <button class="btn btn-secondary" id="test-schedule">
                            <i class="fas fa-play"></i> Test Export Now
                        </button>
                        
                        <div id="schedule-status" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;">
                            <!-- Schedule status will be shown here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Departments Content -->
            <div class="page-content hidden" id="departments-content">
                <div class="content-card">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="view-departments">View Departments</button>
                        <button class="tab-btn" data-tab="add-department">Add Department</button>
                    </div>
                    
                    <div class="tab-content active" id="view-departments">
                        <h3><i class="fas fa-building"></i> All Departments</h3>
                        <button class="btn btn-info" id="export-departments-btn" style="margin-bottom: 15px;">
                            <i class="fas fa-file-csv"></i> Export Departments Report
                        </button>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Department Name</th>
                                    <th>Head</th>
                                    <th>Email</th>
                                    <th>Meetings</th>
                                    <th>Attendees</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="departments-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="add-department">
                        <!-- Restricted content for non-super admins -->
                        <div id="restricted-department-access" class="restricted-access hidden">
                            <i class="fas fa-lock"></i>
                            <h3>Restricted Access</h3>
                            <p>Only Super Admin can add new departments.</p>
                        </div>
                        
                        <!-- Department form (only visible to super admin) -->
                        <div id="department-form-container">
                            <h3><i class="fas fa-plus-circle"></i> Add New Department</h3>
                            <form id="add-department-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="department-name">Department Name/Branch *</label>
                                        <input type="text" id="department-name" class="form-control" placeholder="Loan Department" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="department-head">Department Head *</label>
                                        <input type="text" id="department-head" class="form-control" placeholder="John Doe" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="department-email">Email *</label>
                                        <input type="email" id="department-email" class="form-control" placeholder="loans@bank.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="department-phone">Phone</label>
                                        <input type="tel" id="department-phone" class="form-control" placeholder="+1234567890">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="department-description">Description</label>
                                    <textarea id="department-description" class="form-control" rows="3" placeholder="Department purpose and functions"></textarea>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-building"></i> Add Department
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admins Content -->
            <div class="page-content hidden" id="admins-content">
                <div class="content-card">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="view-admins">View Admins</button>
                        <button class="tab-btn" data-tab="add-admin">Add Admin</button>
                    </div>
                    
                    <div class="tab-content active" id="view-admins">
                        <h3><i class="fas fa-user-shield"></i> All Administrators</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Department</th>
                                    <th>Role</th>
                                    <th>Last Login</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admins-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="add-admin">
                        <!-- Restricted content for non-super admins -->
                        <div id="restricted-admin-access" class="restricted-access hidden">
                            <i class="fas fa-lock"></i>
                            <h3>Restricted Access</h3>
                            <p>Only Super Admin can add new administrators.</p>
                        </div>
                        
                        <!-- Admin form (only visible to super admin) -->
                        <div id="admin-form-container">
                            <h3><i class="fas fa-user-plus"></i> Add New Admin</h3>
                            <form id="add-admin-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="admin-name">Full Name *</label>
                                        <input type="text" id="admin-name" class="form-control" placeholder="John Doe" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-email">Email *</label>
                                        <input type="email" id="admin-email" class="form-control" placeholder="john@bank.com" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="admin-password">Password *</label>
                                        <input type="password" id="admin-password" class="form-control" placeholder="" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-department">Department *</label>
                                        <select id="admin-department" class="form-control" required>
                                            <option value="">Select Department</option>
                                            <!-- Will be populated by JavaScript -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="admin-role">Role *</label>
                                        <select id="admin-role" class="form-control" required>
                                            <option value="admin">Admin</option>
                                            <option value="super_admin">Super Admin</option>
                                            <option value="department_head">Department Head</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-phone">Phone</label>
                                        <input type="tel" id="admin-phone" class="form-control" placeholder="+1234567890">
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-user-plus"></i> Add Admin
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- QR Registration Portal -->
    <div id="registration-portal" class="page" style="display: none;">
        <div class="registration-portal">
            <div class="bank-logo">
                <i class="fas fa-university"></i>
                <h1>Bank Meeting Registration</h1>
            </div>
            
            <div class="registration-card">
                <!-- Alert Messages -->
                <div id="qr-alert-container"></div>
                
                <!-- Registration Form -->
                <div id="registration-form-container">
                    <div class="registration-header">
                        <h2 id="meeting-title">Meeting Registration</h2>
                        <p id="meeting-subtitle">Scan the QR code to register for this meeting</p>
                    </div>
                    
                    <!-- Meeting Information -->
                    <div class="meeting-info">
                        <h3 id="current-meeting-title">Loan Consultation Meeting</h3>
                        <div class="meeting-details">
                            <div class="detail-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span id="meeting-date">January 15, 2024</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-clock"></i>
                                <span id="meeting-time">10:00 AM - 11:00 AM</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span id="meeting-location">Conference Room A</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-building"></i>
                                <span id="meeting-department">Loan Department</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Registration Form -->
                    <form id="attendee-registration-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="full-name">Full Name *</label>
                                <input type="text" id="full-name" class="form-control" placeholder="Enter your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone-number">Phone Number *</label>
                                <input type="tel" id="phone-number" class="form-control" placeholder="+1 (234) 567-8900" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email-address">Email Address *</label>
                                <input type="email" id="email-address" class="form-control" placeholder="your.email@example.com" required>
                            </div>
                            <div class="form-group">
                                <label for="bank-account">Bank Account Number (Optional)</label>
                                <input type="text" id="bank-account" class="form-control" placeholder="Account number if applicable">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="department">Department *</label>
                                <select id="department" class="form-control" required>
                                    <option value="">Select Department</option>
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="purpose">Purpose of Meeting *</label>
                                <select id="purpose" class="form-control" required>
                                    <option value="">Select Purpose</option>
                                    <option value="loan_consultation">Loan Consultation</option>
                                    <option value="account_opening">Account Opening</option>
                                    <option value="investment">Investment Advice</option>
                                    <option value="business">Business Banking</option>
                                    <option value="mortgage">Mortgage Inquiry</option>
                                    <option value="credit_card">Credit Card Application</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="additional-notes">Additional Notes</label>
                            <textarea id="additional-notes" class="form-control" rows="3" placeholder="Any special requirements or questions"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check-circle"></i> Submit Registration
                        </button>
                    </form>
                </div>
                
                <!-- Success Message -->
                <div class="success-message" id="success-message">
                    <i class="fas fa-check-circle"></i>
                    <h3>Registration Successful!</h3>
                    <p>Thank you for registering for the meeting. Your details have been saved successfully.</p>
                    <p>You will receive a confirmation email shortly.</p>
                </div>
                
                <!-- Demo Notice -->
                <div class="demo-notice">
                    <p><i class="fas fa-info-circle"></i> This is a demo registration form. In a real system, this would connect to your database.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qr-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Meeting QR Code</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="qr-container">
                    <div id="qrcode"></div>
                    <div class="qr-info">
                        <h3 id="qr-meeting-title">Meeting Title</h3>
                        <p><strong>Date:</strong> <span id="qr-meeting-date">Loading...</span></p>
                        <p><strong>Time:</strong> <span id="qr-meeting-time">Loading...</span></p>
                        <p><strong>Location:</strong> <span id="qr-meeting-location">Loading...</span></p>
                        <p><strong>Registration Link:</strong> <br><small id="qr-meeting-link">Loading...</small></p>
                        <p class="demo-notes"><i class="fas fa-info-circle"></i> Scan this QR code to register for the meeting</p>
                        <div class="qr-actions">
                            <button class="btn btn-primary" id="download-qr-btn">
                                <i class="fas fa-download"></i> Download QR
                            </button>
                            <button class="btn btn-secondary" id="copy-link-btn">
                                <i class="fas fa-copy"></i> Copy Link
                            </button>
                            <button class="btn btn-success" id="send-email-btn">
                                <i class="fas fa-envelope"></i> Send Email
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Meeting Details Modal -->
    <div id="meeting-details-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Meeting Details</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="meeting-details-content">
                    <!-- Meeting details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Meeting Modal -->
    <div id="edit-meeting-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Meeting</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-meeting-form">
                    <input type="hidden" id="edit-meeting-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-meeting-title">Meeting Title *</label>
                            <input type="text" id="edit-meeting-title" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-meeting-department">Department *</label>
                            <select id="edit-meeting-department" class="form-control" required>
                                <option value="">Select Department</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-meeting-date">Date *</label>
                            <input type="date" id="edit-meeting-date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-meeting-time">Time *</label>
                            <input type="time" id="edit-meeting-time" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-meeting-location">Location *</label>
                            <input type="text" id="edit-meeting-location" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-meeting-duration">Duration (hours) *</label>
                            <input type="number" id="edit-meeting-duration" class="form-control" min="0.5" max="8" step="0.5" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-meeting-description">Description</label>
                        <textarea id="edit-meeting-description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-meeting-max-attendees">Maximum Attendees</label>
                        <input type="number" id="edit-meeting-max-attendees" class="form-control" min="1" max="1000">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-meeting-status">Status *</label>
                        <select id="edit-meeting-status" class="form-control" required>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Attendee Modal -->
    <div id="add-attendee-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Attendee</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="manual-attendee-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="manual-attendee-name">Full Name *</label>
                            <input type="text" id="manual-attendee-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="manual-attendee-email">Email Address *</label>
                            <input type="email" id="manual-attendee-email" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="manual-attendee-phone">Phone Number *</label>
                            <input type="tel" id="manual-attendee-phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="manual-attendee-account">Bank Account Number</label>
                            <input type="text" id="manual-attendee-account" class="form-control" placeholder="Optional">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="manual-attendee-meeting">Meeting *</label>
                            <select id="manual-attendee-meeting" class="form-control" required>
                                <option value="">Select Meeting</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="manual-attendee-purpose">Purpose of Meeting *</label>
                            <select id="manual-attendee-purpose" class="form-control" required>
                                <option value="">Select Purpose</option>
                                <option value="loan_consultation">Loan Consultation</option>
                                <option value="account_opening">Account Opening</option>
                                <option value="investment">Investment Advice</option>
                                <option value="business">Business Banking</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="manual-attendee-notes">Additional Notes</label>
                        <textarea id="manual-attendee-notes" class="form-control" rows="2" placeholder="Any special requirements or notes"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Add Attendee
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- View Attendee Details Modal -->
    <div id="view-attendee-modal" class="modal hidden attendee-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Attendee Details</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="attendee-info" id="attendee-details-content">
                    <!-- Attendee details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Department Modal -->
    <div id="edit-department-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Department</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-department-form">
                    <input type="hidden" id="edit-department-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-department-name">Department Name *</label>
                            <input type="text" id="edit-department-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-department-head">Department Head *</label>
                            <input type="text" id="edit-department-head" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-department-email">Email *</label>
                            <input type="email" id="edit-department-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-department-phone">Phone</label>
                            <input type="tel" id="edit-department-phone" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-department-description">Description</label>
                        <textarea id="edit-department-description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div id="export-options-modal" class="modal hidden">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>Export Options</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options-panel">
                    <h4><i class="fas fa-cog"></i> Configure Export</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="export-format">Format</label>
                            <select id="export-format" class="form-control">
                                <option value="csv">CSV (Excel)</option>
                                <option value="pdf">PDF Report</option>
                                <option value="json">JSON Backup</option>
                                <option value="excel">Excel (Advanced)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="export-date-range">Date Range</label>
                            <select id="export-date-range" class="form-control">
                                <option value="all">All Data</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="custom-date-range" style="display: none; margin-top: 15px;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="export-start-date">Start Date</label>
                                <input type="date" id="export-start-date" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="export-end-date">End Date</label>
                                <input type="date" id="export-end-date" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="export-fields">Include Fields</label>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" name="export-fields" value="name" checked> Name
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" name="export-fields" value="email" checked> Email
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" name="export-fields" value="phone" checked> Phone
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" name="export-fields" value="department" checked> Department
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" name="export-fields" value="meeting" checked> Meeting
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" name="export-fields" value="date" checked> Date
                            </label>
                        </div>
                    </div>
                    
                    <div class="header-actions" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="generate-export">
                            <i class="fas fa-download"></i> Generate Export
                        </button>
                        <button class="btn btn-secondary" id="preview-export">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const appState = {
            currentUser: null,
            meetings: [],
            attendees: [],
            departments: [],
            admins: [],
            charts: {},
            registeredAttendees: [],
            googleSheets: {
                isConnected: false,
                clientId: 'YOUR_GOOGLE_CLIENT_ID', // You need to get this from Google Cloud Console
                apiKey: 'YOUR_GOOGLE_API_KEY',     // You need to get this from Google Cloud Console
                spreadsheetId: null,
                accessToken: null
            }
        };

        // Real-time Event System
        const realTimeSystem = {
            lastCheck: 0,
            checkInterval: 2000, // Check every 2 seconds
            notificationQueue: [],
            
            init() {
                console.log('Real-time system initialized');
                this.startPolling();
                
                // Listen for storage events (cross-tab communication)
                window.addEventListener('storage', (e) => {
                    if (e.key === 'bankMeetingAttendees' || e.key === 'bankMeetingMeetings') {
                        this.handleDataChange();
                    }
                    if (e.key && e.key.startsWith('rt_notification_')) {
                        this.processNotification(e.newValue);
                    }
                });
            },
            
            startPolling() {
                setInterval(() => {
                    this.checkForUpdates();
                }, this.checkInterval);
            },
            
            checkForUpdates() {
                if (!appState.currentUser) return;
                
                // Check for new attendees
                const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
                const lastAttendeeCount = appState.attendees.length;
                
                if (savedAttendees.length > lastAttendeeCount) {
                    // New attendees detected
                    const newAttendees = savedAttendees.slice(lastAttendeeCount);
                    
                    // Update appState
                    appState.attendees = savedAttendees;
                    
                    // Update meetings attendees
                    this.updateMeetingAttendees(newAttendees);
                    
                    // Show notifications
                    newAttendees.forEach(attendee => {
                        this.showNotification(attendee);
                    });
                    
                    // Update UI
                    if (typeof updateAllData === 'function') {
                        updateAllData();
                    }
                    
                    // Show live registration counter
                    this.showLiveRegistrationCounter(newAttendees.length);
                }
                
                // Check for notification queue
                this.processNotificationQueue();
            },
            
            updateMeetingAttendees(newAttendees) {
                const savedMeetings = JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]');
                
                newAttendees.forEach(attendee => {
                    const meeting = savedMeetings.find(m => m.id === attendee.meetingId);
                    if (meeting) {
                        meeting.attendees = meeting.attendees || [];
                        meeting.attendees.push(attendee);
                    }
                });
                
                localStorage.setItem('bankMeetingMeetings', JSON.stringify(savedMeetings));
                appState.meetings = savedMeetings;
            },
            
            handleDataChange() {
                // Reload data from localStorage
                loadDataFromLocalStorage();
                
                // Update UI
                if (typeof updateAllData === 'function') {
                    updateAllData();
                }
            },
            
            showNotification(attendee) {
                const notification = {
                    id: Date.now(),
                    type: 'new_registration',
                    attendee: attendee,
                    timestamp: new Date().toLocaleTimeString(),
                    read: false
                };
                
                // Add to queue
                this.notificationQueue.push(notification);
                
                // Save to localStorage for cross-tab
                localStorage.setItem(`rt_notification_${notification.id}`, JSON.stringify(notification));
                
                // Remove old notifications
                this.cleanupOldNotifications();
                
                // Display notification
                this.displayNotification(notification);
            },
            
            displayNotification(notification) {
                if (!appState.currentUser) return;
                
                const notificationDiv = document.createElement('div');
                notificationDiv.className = 'real-time-notification';
                notificationDiv.setAttribute('data-notification-id', notification.id);
                notificationDiv.innerHTML = `
                    <i class="fas fa-user-check"></i>
                    <div class="real-time-notification-content">
                        <strong>New Registration!</strong>
                        <p>${notification.attendee.name} registered for "${notification.attendee.meetingTitle}"</p>
                        <div class="real-time-notification-time">${notification.timestamp}</div>
                    </div>
                    <i class="fas fa-times" style="cursor: pointer;"></i>
                `;
                
                document.body.appendChild(notificationDiv);
                
                // Add click event to close
                notificationDiv.querySelector('.fa-times').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.removeNotification(notificationDiv, notification.id);
                });
                
                // Add click event to view attendee
                notificationDiv.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('fa-times')) {
                        viewAttendeeDetails(notification.attendee.id);
                        this.removeNotification(notificationDiv, notification.id);
                    }
                });
                
                // Auto-remove after 8 seconds
                setTimeout(() => {
                    if (notificationDiv.parentNode) {
                        this.removeNotification(notificationDiv, notification.id);
                    }
                }, 8000);
                
                // Play notification sound (optional)
                this.playNotificationSound();
            },
            
            removeNotification(notificationDiv, notificationId) {
                notificationDiv.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    if (notificationDiv.parentNode) {
                        notificationDiv.parentNode.removeChild(notificationDiv);
                    }
                    // Remove from localStorage
                    localStorage.removeItem(`rt_notification_${notificationId}`);
                }, 300);
            },
            
            processNotification(data) {
                try {
                    const notification = JSON.parse(data);
                    if (notification.type === 'new_registration' && appState.currentUser) {
                        this.displayNotification(notification);
                    }
                } catch (e) {
                    console.error('Error processing notification:', e);
                }
            },
            
            processNotificationQueue() {
                // Process any pending notifications in localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('rt_notification_')) {
                        try {
                            const notification = JSON.parse(localStorage.getItem(key));
                            if (!notification.read && appState.currentUser) {
                                this.displayNotification(notification);
                                notification.read = true;
                                localStorage.setItem(key, JSON.stringify(notification));
                            }
                        } catch (e) {
                            localStorage.removeItem(key);
                        }
                    }
                }
            },
            
            cleanupOldNotifications() {
                const now = Date.now();
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('rt_notification_')) {
                        try {
                            const notification = JSON.parse(localStorage.getItem(key));
                            if (now - notification.id > 300000) { // 5 minutes old
                                localStorage.removeItem(key);
                            }
                        } catch (e) {
                            localStorage.removeItem(key);
                        }
                    }
                }
            },
            
            showLiveRegistrationCounter(count) {
                // Remove existing counter
                const existingCounter = document.querySelector('.live-registration-counter');
                if (existingCounter) {
                    existingCounter.remove();
                }
                
                if (count > 0) {
                    const counterDiv = document.createElement('div');
                    counterDiv.className = 'live-registration-counter';
                    counterDiv.innerHTML = `
                        <i class="fas fa-bell"></i>
                        <span>${count} new registration${count > 1 ? 's' : ''}</span>
                    `;
                    
                    document.body.appendChild(counterDiv);
                    
                    // Auto-remove after 5 seconds
                    setTimeout(() => {
                        if (counterDiv.parentNode) {
                            counterDiv.style.animation = 'fadeOut 0.3s ease-out';
                            setTimeout(() => {
                                if (counterDiv.parentNode) {
                                    counterDiv.parentNode.removeChild(counterDiv);
                                }
                            }, 300);
                        }
                    }, 5000);
                }
            },
            
            playNotificationSound() {
                // Create a simple notification sound
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    // Fallback to simple beep if Web Audio API not supported
                    console.log(' New registration!');
                }
            }
        };

        // Initialize demo data with proper passwords
        function initializeDemoData() {
            // Demo departments
            appState.departments = [
                { id: 1, name: 'Loan Department', head: 'John Manager', email: 'loans@bank.com', phone: '+1234567890', description: 'Handles all loan applications and consultations', createdAt: '2024-01-01' },
                { id: 2, name: 'Investment Banking', head: 'Sarah Investor', email: 'investments@bank.com', phone: '+1234567891', description: 'Investment advice and portfolio management', createdAt: '2024-01-01' },
                { id: 3, name: 'Customer Service', head: 'Mike Support', email: 'support@bank.com', phone: '+1234567892', description: 'Customer support and general inquiries', createdAt: '2024-01-01' }
            ];

            // Demo admins WITH PROPER PASSWORDS
            appState.admins = [
                { 
                    id: 1, 
                    name: 'Henry Ghansah', 
                    email: 'ghansah.henry@myumbbank.com', 
                    department: 'Loan Department', 
                    role: 'super_admin', 
                    phone: '+1234567893', 
                    password: 'Windows@@055020', // Storing password
                    lastLogin: '2024-01-15 10:30:00', 
                    status: 'active',
                    createdAt: '2024-01-01'
                },
                { 
                    id: 2, 
                    name: 'John Manager', 
                    email: 'john@bank.com', 
                    department: 'Loan Department', 
                    role: 'admin', 
                    phone: '+1234567894', 
                    password: 'admin123', // Default password for new admins
                    lastLogin: '2024-01-14 14:20:00', 
                    status: 'active',
                    createdAt: '2024-01-01'
                },
                { 
                    id: 3, 
                    name: 'Sarah Investor', 
                    email: 'sarah@bank.com', 
                    department: 'Investment Banking', 
                    role: 'department_head', 
                    phone: '+1234567895', 
                    password: 'admin123', // Default password for new admins
                    lastLogin: '2024-01-13 09:15:00', 
                    status: 'active',
                    createdAt: '2024-01-01'
                }
            ];

            // Demo meetings
            appState.meetings = [
                { id: 1, title: 'Loan Consultation', department: 'Loan Department', date: '2024-01-15', time: '10:00', location: 'Conference Room A', duration: 1, description: 'Personal loan consultation session', maxAttendees: 10, status: 'active', createdAt: '2024-01-10', attendees: [] },
                { id: 2, title: 'Investment Seminar', department: 'Investment Banking', date: '2024-01-14', time: '14:00', location: 'Auditorium', duration: 2, description: 'Quarterly investment seminar', maxAttendees: 50, status: 'completed', createdAt: '2024-01-05', attendees: [] },
                { id: 3, title: 'Account Opening', department: 'Customer Service', date: '2024-01-16', time: '09:00', location: 'Service Desk 1', duration: 0.5, description: 'New account opening session', maxAttendees: 5, status: 'active', createdAt: '2024-01-12', attendees: [] }
            ];

            // Demo attendees
            appState.attendees = [
                { id: 1, name: 'Alice Johnson', email: 'alice@email.com', phone: '+1234567001', account: 'ACC001234', meetingId: 1, meetingTitle: 'Loan Consultation', meetingDate: '2024-01-15', meetingTime: '10:00', department: 'Loan Department', purpose: 'loan_consultation', notes: 'Interested in home loan', registrationDate: '2024-01-12 09:15:00' },
                { id: 2, name: 'Bob Smith', email: 'bob@email.com', phone: '+1234567002', account: 'ACC001235', meetingId: 2, meetingTitle: 'Investment Seminar', meetingDate: '2024-01-14', meetingTime: '14:00', department: 'Investment Banking', purpose: 'investment', notes: 'Retirement planning', registrationDate: '2024-01-11 14:30:00' },
                { id: 3, name: 'Charlie Brown', email: 'charlie@email.com', phone: '+1234567003', account: 'ACC001236', meetingId: 3, meetingTitle: 'Account Opening', meetingDate: '2024-01-16', meetingTime: '09:00', department: 'Customer Service', purpose: 'account_opening', notes: 'Opening business account', registrationDate: '2024-01-13 11:00:00' },
                { id: 4, name: 'Diana Prince', email: 'diana@email.com', phone: '+1234567004', account: 'ACC001237', meetingId: 1, meetingTitle: 'Loan Consultation', meetingDate: '2024-01-15', meetingTime: '10:00', department: 'Loan Department', purpose: 'loan_consultation', notes: 'Car loan inquiry', registrationDate: '2024-01-14 15:45:00' }
            ];

            // Link attendees to meetings
            appState.meetings[0].attendees = [appState.attendees[0], appState.attendees[3]];
            appState.meetings[1].attendees = [appState.attendees[1]];
            appState.meetings[2].attendees = [appState.attendees[2]];

            // Save to localStorage for persistence
            saveDataToLocalStorage();
        }

        // Save all data to localStorage
        function saveDataToLocalStorage() {
            localStorage.setItem('bankMeetingAdmins', JSON.stringify(appState.admins));
            localStorage.setItem('bankMeetingDepartments', JSON.stringify(appState.departments));
            localStorage.setItem('bankMeetingMeetings', JSON.stringify(appState.meetings));
            localStorage.setItem('bankMeetingAttendees', JSON.stringify(appState.attendees));
            
            // Trigger storage event for cross-tab communication
            const event = new Event('storage');
            window.dispatchEvent(event);
        }

        // Load data from localStorage
        function loadDataFromLocalStorage() {
            const savedAdmins = localStorage.getItem('bankMeetingAdmins');
            const savedDepartments = localStorage.getItem('bankMeetingDepartments');
            const savedMeetings = localStorage.getItem('bankMeetingMeetings');
            const savedAttendees = localStorage.getItem('bankMeetingAttendees');

            if (savedAdmins) appState.admins = JSON.parse(savedAdmins);
            if (savedDepartments) appState.departments = JSON.parse(savedDepartments);
            if (savedMeetings) appState.meetings = JSON.parse(savedMeetings);
            if (savedAttendees) appState.attendees = JSON.parse(savedAttendees);

            // If no data exists, initialize demo data
            if (appState.admins.length === 0) {
                initializeDemoData();
            }
        }

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const dashboardPage = document.getElementById('dashboard-page');
        const registrationPortal = document.getElementById('registration-portal');
        const loginForm = document.getElementById('login-form');
        const loginAlert = document.getElementById('login-alert');
        const alertContainer = document.getElementById('alert-container');

        // ==================== ENHANCED CSV & EXPORT FUNCTIONS ====================

        // Enhanced CSV Export Functions
        function exportToCSV(data, filename, headers = null) {
            if (data.length === 0) {
                showAlert('No data to export', 'error');
                return;
            }
            
            // Use provided headers or generate from first object
            const csvHeaders = headers || Object.keys(data[0]);
            
            // Build CSV content
            const csvContent = [
                csvHeaders.join(','),
                ...data.map(row => {
                    return csvHeaders.map(header => {
                        // Handle nested objects and special characters
                        const value = getNestedValue(row, header);
                        // Escape quotes and wrap in quotes if contains comma, quotes, or newline
                        const escapedValue = String(value).replace(/"/g, '""');
                        return escapedValue.includes(',') || escapedValue.includes('"') || escapedValue.includes('\n') 
                            ? `"${escapedValue}"` 
                            : escapedValue;
                    }).join(',');
                })
            ].join('\n');
            
            // Create and trigger download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", `${filename}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up
            setTimeout(() => URL.revokeObjectURL(url), 100);
        }

        // Helper function to get nested values
        function getNestedValue(obj, path) {
            return path.split('.').reduce((current, key) => {
                return current && current[key] !== undefined ? current[key] : '';
            }, obj);
        }

        // Export all attendees with detailed information
        function exportAllAttendeesCSV() {
            const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
            
            // Transform data for CSV
            const csvData = savedAttendees.map(attendee => ({
                'ID': attendee.id,
                'Full Name': attendee.name,
                'Email': attendee.email,
                'Phone': attendee.phone,
                'Account Number': attendee.account || '',
                'Meeting ID': attendee.meetingId,
                'Meeting Title': attendee.meetingTitle || attendee.meeting,
                'Meeting Date': attendee.meetingDate,
                'Meeting Time': attendee.meetingTime,
                'Department': attendee.departmentName || attendee.department,
                'Purpose': attendee.purpose,
                'Purpose Description': {
                    'loan_consultation': 'Loan Consultation',
                    'account_opening': 'Account Opening',
                    'investment': 'Investment Advice',
                    'business': 'Business Banking',
                    'mortgage': 'Mortgage Inquiry',
                    'credit_card': 'Credit Card Application',
                    'other': 'Other'
                }[attendee.purpose] || attendee.purpose,
                'Registration Date': attendee.registrationDate,
                'Status': attendee.status || 'registered',
                'Notes': attendee.notes || ''
            }));
            
            const headers = [
                'ID', 'Full Name', 'Email', 'Phone', 'Account Number',
                'Meeting ID', 'Meeting Title', 'Meeting Date', 'Meeting Time',
                'Department', 'Purpose', 'Purpose Description', 
                'Registration Date', 'Status', 'Notes'
            ];
            
            exportToCSV(csvData, 'bank_meeting_attendees', headers);
            showAlert(`Exported ${savedAttendees.length} attendees to CSV`, 'success');
        }

        // Export all meetings with statistics
        function exportAllMeetingsCSV() {
            const savedMeetings = JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]');
            const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
            
            const csvData = savedMeetings.map(meeting => {
                const meetingAttendees = savedAttendees.filter(a => a.meetingId === meeting.id);
                
                return {
                    'Meeting ID': meeting.id,
                    'Title': meeting.title,
                    'Date': meeting.date,
                    'Time': meeting.time,
                    'Location': meeting.location,
                    'Department': meeting.department,
                    'Duration (hours)': meeting.duration,
                    'Maximum Attendees': meeting.maxAttendees || 'Unlimited',
                    'Current Attendees': meetingAttendees.length,
                    'Attendance Rate': meeting.maxAttendees ? 
                        `${((meetingAttendees.length / meeting.maxAttendees) * 100).toFixed(1)}%` : 
                        'N/A',
                    'Status': meeting.status,
                    'Description': meeting.description || '',
                    'Created Date': meeting.createdAt,
                    'Last Updated': new Date().toISOString().split('T')[0]
                };
            });
            
            const headers = [
                'Meeting ID', 'Title', 'Date', 'Time', 'Location',
                'Department', 'Duration (hours)', 'Maximum Attendees',
                'Current Attendees', 'Attendance Rate', 'Status',
                'Description', 'Created Date', 'Last Updated'
            ];
            
            exportToCSV(csvData, 'bank_meetings_summary', headers);
            showAlert(`Exported ${savedMeetings.length} meetings to CSV`, 'success');
        }

        // Export department-wise report
        function exportDepartmentsReportCSV() {
            const savedDepartments = JSON.parse(localStorage.getItem('bankMeetingDepartments') || '[]');
            const savedMeetings = JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]');
            const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
            
            const csvData = savedDepartments.map(dept => {
                const departmentMeetings = savedMeetings.filter(m => m.department === dept.name);
                const departmentAttendees = savedAttendees.filter(a => 
                    a.department === dept.name || a.departmentName === dept.name
                );
                
                return {
                    'Department ID': dept.id,
                    'Department Name': dept.name,
                    'Department Head': dept.head,
                    'Email': dept.email,
                    'Phone': dept.phone || '',
                    'Total Meetings': departmentMeetings.length,
                    'Active Meetings': departmentMeetings.filter(m => m.status === 'active').length,
                    'Total Attendees': departmentAttendees.length,
                    'Description': dept.description || '',
                    'Created Date': dept.createdAt,
                    'Performance Score': calculateDepartmentScore(departmentMeetings, departmentAttendees)
                };
            });
            
            const headers = [
                'Department ID', 'Department Name', 'Department Head', 'Email', 'Phone',
                'Total Meetings', 'Active Meetings', 'Total Attendees',
                'Description', 'Created Date', 'Performance Score'
            ];
            
            exportToCSV(csvData, 'departments_report', headers);
            showAlert(`Exported ${savedDepartments.length} departments report to CSV`, 'success');
        }

        // Export detailed meeting with all attendees
        function exportMeetingWithAttendees(meetingId) {
            const savedMeetings = JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]');
            const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
            
            const meeting = savedMeetings.find(m => m.id === meetingId);
            if (!meeting) {
                showAlert('Meeting not found', 'error');
                return;
            }
            
            const meetingAttendees = savedAttendees.filter(a => a.meetingId === meetingId);
            
            if (meetingAttendees.length === 0) {
                showAlert('No attendees found for this meeting', 'error');
                return;
            }
            
            // Create CSV for meeting details
            const meetingData = [{
                'Meeting ID': meeting.id,
                'Title': meeting.title,
                'Date': meeting.date,
                'Time': meeting.time,
                'Location': meeting.location,
                'Department': meeting.department,
                'Duration (hours)': meeting.duration,
                'Status': meeting.status,
                'Description': meeting.description || '',
                'Total Attendees': meetingAttendees.length,
                'Export Date': new Date().toLocaleString()
            }];
            
            exportToCSV(meetingData, `${meeting.title.replace(/[^a-z0-9]/gi, '_')}_details`);
            
            // Create CSV for attendees
            const attendeesData = meetingAttendees.map(attendee => ({
                'Attendee ID': attendee.id,
                'Full Name': attendee.name,
                'Email': attendee.email,
                'Phone': attendee.phone,
                'Account Number': attendee.account || '',
                'Purpose': {
                    'loan_consultation': 'Loan Consultation',
                    'account_opening': 'Account Opening',
                    'investment': 'Investment Advice',
                    'business': 'Business Banking',
                    'other': 'Other'
                }[attendee.purpose] || attendee.purpose,
                'Registration Date': attendee.registrationDate,
                'Notes': attendee.notes || ''
            }));
            
            exportToCSV(attendeesData, `${meeting.title.replace(/[^a-z0-9]/gi, '_')}_attendees`);
            
            showAlert(`Exported meeting details and ${meetingAttendees.length} attendees to CSV files`, 'success');
        }

        // Helper function to calculate department performance score
        function calculateDepartmentScore(meetings, attendees) {
            if (meetings.length === 0) return 'N/A';
            
            const activeMeetings = meetings.filter(m => m.status === 'active').length;
            const completionRate = meetings.length > 0 ? 
                (meetings.filter(m => m.status === 'completed').length / meetings.length) * 100 : 0;
            const avgAttendeesPerMeeting = meetings.length > 0 ? attendees.length / meetings.length : 0;
            
            const score = (activeMeetings * 10) + (completionRate * 0.5) + (avgAttendeesPerMeeting * 5);
            return Math.min(100, Math.max(0, score)).toFixed(1);
        }

        // ==================== PDF REPORT GENERATION ====================

        // Generate PDF Report
        function generatePDFReport(type = 'summary') {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            
            // Get data
            const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
            const savedMeetings = JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]');
            const savedDepartments = JSON.parse(localStorage.getItem('bankMeetingDepartments') || '[]');
            
            // Set title
            const today = new Date().toLocaleDateString();
            doc.setFontSize(18);
            doc.setTextColor(40, 40, 40);
            doc.text('Bank Meeting System Report', 40, 40);
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`Generated on: ${today}`, 40, 65);
            doc.text(`Report Type: ${type.charAt(0).toUpperCase() + type.slice(1)} Report`, 40, 80);
            
            let yPos = 120;
            
            if (type === 'summary') {
                // Summary statistics
                doc.setFontSize(14);
                doc.setTextColor(40, 40, 40);
                doc.text('System Summary', 40, yPos);
                yPos += 30;
                
                const stats = [
                    ['Total Meetings', savedMeetings.length],
                    ['Total Attendees', savedAttendees.length],
                    ['Total Departments', savedDepartments.length],
                    ['Active Meetings', savedMeetings.filter(m => m.status === 'active').length]
                ];
                
                doc.setFontSize(11);
                stats.forEach(([label, value]) => {
                    doc.text(`${label}: ${value}`, 60, yPos);
                    yPos += 20;
                });
                
                yPos += 20;
                
                // Meetings table
                if (savedMeetings.length > 0) {
                    doc.setFontSize(14);
                    doc.text('Meetings Overview', 40, yPos);
                    yPos += 30;
                    
                    const meetingsData = savedMeetings.map(meeting => [
                        meeting.title,
                        meeting.date,
                        meeting.department,
                        meeting.status,
                        meeting.attendees ? meeting.attendees.length : 0
                    ]);
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Title', 'Date', 'Department', 'Status', 'Attendees']],
                        body: meetingsData,
                        theme: 'grid',
                        headStyles: { fillColor: [255, 219, 88] },
                        margin: { top: 40 }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 30;
                }
                
                // Departments table
                if (savedDepartments.length > 0) {
                    doc.addPage();
                    doc.setFontSize(14);
                    doc.text('Departments Overview', 40, 40);
                    
                    const deptData = savedDepartments.map(dept => {
                        const deptMeetings = savedMeetings.filter(m => m.department === dept.name);
                        const deptAttendees = savedAttendees.filter(a => 
                            a.department === dept.name || a.departmentName === dept.name
                        );
                        return [
                            dept.name,
                            dept.head,
                            deptMeetings.length,
                            deptAttendees.length
                        ];
                    });
                    
                    doc.autoTable({
                        startY: 70,
                        head: [['Department', 'Head', 'Meetings', 'Attendees']],
                        body: deptData,
                        theme: 'grid',
                        headStyles: { fillColor: [66, 133, 244] }
                    });
                }
                
            } else if (type === 'detailed') {
                // Detailed attendees report
                doc.setFontSize(14);
                doc.text('Detailed Attendees Report', 40, yPos);
                yPos += 30;
                
                const attendeesData = savedAttendees.map(attendee => [
                    attendee.name,
                    attendee.email,
                    attendee.phone,
                    attendee.meetingTitle || 'N/A',
                    attendee.departmentName || attendee.department || 'N/A',
                    new Date(attendee.registrationDate).toLocaleDateString()
                ]);
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Name', 'Email', 'Phone', 'Meeting', 'Department', 'Registration Date']],
                    body: attendeesData,
                    theme: 'grid',
                    headStyles: { fillColor: [76, 175, 80] },
                    styles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 60 },
                        1: { cellWidth: 80 },
                        2: { cellWidth: 60 },
                        3: { cellWidth: 70 },
                        4: { cellWidth: 50 },
                        5: { cellWidth: 50 }
                    },
                    margin: { top: 40 }
                });
            }
            
            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(10);
                doc.setTextColor(150, 150, 150);
                doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 100, doc.internal.pageSize.height - 20);
                doc.text('Bank Meeting System - Confidential', 40, doc.internal.pageSize.height - 20);
            }
            
            // Save PDF
            const fileName = `bank_meeting_report_${type}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
            showAlert(`PDF report generated: ${fileName}`, 'success');
        }

        // Generate Comprehensive PDF Report
        function generateComprehensivePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            
            // Get all data
            const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
            const savedMeetings = JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]');
            const savedDepartments = JSON.parse(localStorage.getItem('bankMeetingDepartments') || '[]');
            
            // Cover Page
            doc.setFillColor(255, 219, 88);
            doc.rect(0, 0, doc.internal.pageSize.width, 100, 'F');
            
            doc.setFontSize(28);
            doc.setTextColor(0, 0, 0);
            doc.text('Bank Meeting System', 40, 60);
            
            doc.setFontSize(14);
            doc.setTextColor(40, 40, 40);
            doc.text('Comprehensive Report', 40, 90);
            
            const today = new Date().toLocaleDateString();
            doc.setFontSize(12);
            doc.text(`Generated: ${today}`, 40, 120);
            
            // Executive Summary
            doc.addPage();
            doc.setFontSize(18);
            doc.text('Executive Summary', 40, 40);
            
            doc.setFontSize(11);
            let y = 80;
            
            const summaryData = [
                ['Total Meetings', savedMeetings.length],
                ['Active Meetings', savedMeetings.filter(m => m.status === 'active').length],
                ['Total Attendees', savedAttendees.length],
                ['Total Departments', savedDepartments.length],
                ['Avg Attendees per Meeting', savedMeetings.length > 0 ? (savedAttendees.length / savedMeetings.length).toFixed(1) : 0],
                ['Completion Rate', savedMeetings.length > 0 ? 
                    `${((savedMeetings.filter(m => m.status === 'completed').length / savedMeetings.length) * 100).toFixed(1)}%` : '0%']
            ];
            
            summaryData.forEach(([label, value]) => {
                doc.text(`${label}:`, 60, y);
                doc.text(`${value}`, 200, y);
                y += 20;
            });
            
            // Meetings Analysis
            y += 20;
            doc.setFontSize(14);
            doc.text('Meetings Analysis', 40, y);
            y += 30;
            
            const meetingsData = savedMeetings.map(meeting => [
                meeting.title,
                meeting.date,
                meeting.department,
                meeting.status,
                meeting.attendees ? meeting.attendees.length : 0,
                meeting.maxAttendees || 'Unlimited'
            ]);
            
            doc.autoTable({
                startY: y,
                head: [['Title', 'Date', 'Department', 'Status', 'Attendees', 'Max']],
                body: meetingsData,
                theme: 'grid',
                headStyles: { fillColor: [255, 219, 88] }
            });
            
            // Department Performance
            doc.addPage();
            doc.setFontSize(18);
            doc.text('Department Performance', 40, 40);
            
            const deptData = savedDepartments.map(dept => {
                const deptMeetings = savedMeetings.filter(m => m.department === dept.name);
                const deptAttendees = savedAttendees.filter(a => 
                    a.department === dept.name || a.departmentName === dept.name
                );
                
                const active = deptMeetings.filter(m => m.status === 'active').length;
                const completed = deptMeetings.filter(m => m.status === 'completed').length;
                const score = calculateDepartmentScore(deptMeetings, deptAttendees);
                
                return [
                    dept.name,
                    dept.head,
                    deptMeetings.length,
                    active,
                    completed,
                    deptAttendees.length,
                    score
                ];
            });
            
            doc.autoTable({
                startY: 70,
                head: [['Department', 'Head', 'Total Meetings', 'Active', 'Completed', 'Attendees', 'Score']],
                body: deptData,
                theme: 'grid',
                headStyles: { fillColor: [66, 133, 244] },
                columnStyles: {
                    6: { fillColor: score => score > 70 ? [220, 255, 220] : score > 40 ? [255, 255, 220] : [255, 220, 220] }
                }
            });
            
            // Attendance Trend
            if (savedAttendees.length > 0) {
                doc.addPage();
                doc.setFontSize(18);
                doc.text('Attendance Trends', 40, 40);
                
                // Group by date
                const attendanceByDate = {};
                savedAttendees.forEach(attendee => {
                    const date = new Date(attendee.registrationDate).toLocaleDateString();
                    attendanceByDate[date] = (attendanceByDate[date] || 0) + 1;
                });
                
                const dates = Object.keys(attendanceByDate).slice(-7); // Last 7 days
                const counts = dates.map(date => attendanceByDate[date]);
                
                // Simple chart using text
                const maxCount = Math.max(...counts);
                const chartWidth = 400;
                const chartHeight = 200;
                const chartX = 40;
                const chartY = 80;
                
                // Draw axes
                doc.setDrawColor(200, 200, 200);
                doc.line(chartX, chartY, chartX, chartY + chartHeight);
                doc.line(chartX, chartY + chartHeight, chartX + chartWidth, chartY + chartHeight);
                
                // Draw bars
                const barWidth = chartWidth / dates.length;
                dates.forEach((date, index) => {
                    const barHeight = (counts[index] / maxCount) * chartHeight;
                    const x = chartX + (index * barWidth) + 5;
                    const y = chartY + chartHeight - barHeight;
                    
                    doc.setFillColor(76, 175, 80);
                    doc.rect(x, y, barWidth - 10, barHeight, 'F');
                    
                    doc.setFontSize(8);
                    doc.setTextColor(40, 40, 40);
                    doc.text(date, x + 5, chartY + chartHeight + 15);
                    doc.text(counts[index].toString(), x + 5, y - 5);
                });
            }
            
            // Recommendations
            doc.addPage();
            doc.setFontSize(18);
            doc.text('Recommendations & Insights', 40, 40);
            
            doc.setFontSize(11);
            y = 80;
            
            const recommendations = [
                'Increase marketing for low-attendance meetings',
                'Schedule meetings based on peak attendance periods',
                'Consider expanding popular meeting topics',
                'Review department performance quarterly',
                'Implement feedback system for attendees'
            ];
            
            recommendations.forEach((rec, index) => {
                doc.text(`${index + 1}. ${rec}`, 60, y);
                y += 20;
            });
            
            // Save PDF
            const fileName = `comprehensive_report_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
            showAlert(`Comprehensive PDF report generated: ${fileName}`, 'success');
        }

        // ==================== GOOGLE SHEETS INTEGRATION ====================

        // Initialize Google Sheets API
        function initGoogleSheets() {
            gapi.load('client:auth2', () => {
                gapi.client.init({
                    apiKey: appState.googleSheets.apiKey,
                    clientId: appState.googleSheets.clientId,
                    discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                    scope: "https://www.googleapis.com/auth/spreadsheets"
                }).then(() => {
                    console.log('Google Sheets API initialized');
                }).catch(error => {
                    console.error('Error initializing Google Sheets:', error);
                    showAlert('Google Sheets API initialization failed. Please check your credentials.', 'error');
                });
            });
        }

        // Connect to Google Sheets
        function connectGoogleSheets() {
            if (!gapi.auth2) {
                showAlert('Google API not loaded. Please refresh the page.', 'error');
                return;
            }
            
            const authInstance = gapi.auth2.getAuthInstance();
            if (!authInstance.isSignedIn.get()) {
                authInstance.signIn().then(() => {
                    appState.googleSheets.isConnected = true;
                    appState.googleSheets.accessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
                    updateGoogleSheetsStatus('Connected to Google Sheets', 'success');
                    showAlert('Successfully connected to Google Sheets!', 'success');
                }).catch(error => {
                    console.error('Sign-in error:', error);
                    showAlert('Failed to connect to Google Sheets. Please try again.', 'error');
                });
            } else {
                appState.googleSheets.isConnected = true;
                updateGoogleSheetsStatus('Already connected to Google Sheets', 'success');
                showAlert('Already connected to Google Sheets!', 'success');
            }
        }

        // Export data to Google Sheets
        async function exportToGoogleSheets(dataType = 'attendees') {
            if (!appState.googleSheets.isConnected) {
                showAlert('Please connect to Google Sheets first.', 'error');
                return;
            }
            
            const statusDiv = document.getElementById('google-sheets-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<div class="spinner"></div> Exporting data to Google Sheets...';
            statusDiv.className = 'alert alert-info';
            
            try {
                // Get data
                let data, sheetName, headers;
                const sheetTitle = document.getElementById('sheet-name').value || 'Bank Meeting Data';
                
                if (dataType === 'attendees') {
                    const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
                    data = savedAttendees.map(attendee => [
                        attendee.name,
                        attendee.email,
                        attendee.phone,
                        attendee.account || '',
                        attendee.meetingTitle || '',
                        attendee.meetingDate || '',
                        attendee.departmentName || attendee.department || '',
                        attendee.registrationDate
                    ]);
                    headers = ['Name', 'Email', 'Phone', 'Account', 'Meeting', 'Date', 'Department', 'Registration'];
                    sheetName = `${sheetTitle} - Attendees`;
                    
                } else if (dataType === 'meetings') {
                    const savedMeetings = JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]');
                    data = savedMeetings.map(meeting => [
                        meeting.title,
                        meeting.date,
                        meeting.time,
                        meeting.department,
                        meeting.location,
                        meeting.status,
                        meeting.attendees ? meeting.attendees.length : 0,
                        meeting.maxAttendees || 'Unlimited'
                    ]);
                    headers = ['Title', 'Date', 'Time', 'Department', 'Location', 'Status', 'Attendees', 'Max'];
                    sheetName = `${sheetTitle} - Meetings`;
                    
                } else if (dataType === 'departments') {
                    const savedDepartments = JSON.parse(localStorage.getItem('bankMeetingDepartments') || '[]');
                    data = savedDepartments.map(dept => [
                        dept.name,
                        dept.head,
                        dept.email,
                        dept.phone || '',
                        dept.description || ''
                    ]);
                    headers = ['Department', 'Head', 'Email', 'Phone', 'Description'];
                    sheetName = `${sheetTitle} - Departments`;
                    
                } else if (dataType === 'all') {
                    // Export all data to different sheets
                    await exportAllDataToSheets(sheetTitle);
                    return;
                }
                
                // Create or get spreadsheet
                let spreadsheetId = appState.googleSheets.spreadsheetId;
                if (!spreadsheetId) {
                    spreadsheetId = await createNewSpreadsheet(sheetName);
                    appState.googleSheets.spreadsheetId = spreadsheetId;
                }
                
                // Update spreadsheet
                await updateSpreadsheet(spreadsheetId, sheetName, headers, data);
                
                statusDiv.innerHTML = `<i class="fas fa-check-circle"></i> Successfully exported ${data.length} records to Google Sheets!`;
                statusDiv.className = 'alert alert-success';
                showAlert(`Exported ${data.length} records to Google Sheets`, 'success');
                
            } catch (error) {
                console.error('Export error:', error);
                statusDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> Export failed: ${error.message}`;
                statusDiv.className = 'alert alert-error';
                showAlert('Export to Google Sheets failed', 'error');
            }
        }

        // Create new spreadsheet
        async function createNewSpreadsheet(title) {
            const response = await gapi.client.sheets.spreadsheets.create({
                properties: {
                    title: title
                }
            });
            
            return response.result.spreadsheetId;
        }

        // Update spreadsheet with data
        async function updateSpreadsheet(spreadsheetId, sheetName, headers, data) {
            // Clear existing data
            await gapi.client.sheets.spreadsheets.values.clear({
                spreadsheetId: spreadsheetId,
                range: 'A1:Z1000'
            });
            
            // Write headers
            await gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: spreadsheetId,
                range: 'A1',
                valueInputOption: 'RAW',
                resource: {
                    values: [headers]
                }
            });
            
            // Write data
            if (data.length > 0) {
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: spreadsheetId,
                    range: 'A2',
                    valueInputOption: 'RAW',
                    resource: {
                        values: data
                    }
                });
            }
            
            // Format headers
            await gapi.client.sheets.spreadsheets.batchUpdate({
                spreadsheetId: spreadsheetId,
                resource: {
                    requests: [{
                        repeatCell: {
                            range: {
                                sheetId: 0,
                                startRowIndex: 0,
                                endRowIndex: 1
                            },
                            cell: {
                                userEnteredFormat: {
                                    backgroundColor: {
                                        red: 0.9,
                                        green: 0.9,
                                        blue: 0.9
                                    },
                                    textFormat: {
                                        bold: true
                                    }
                                }
                            },
                            fields: "userEnteredFormat(backgroundColor,textFormat)"
                        }
                    }]
                }
            });
        }

        // Export all data to Google Sheets
        async function exportAllDataToSheets(mainTitle) {
            try {
                // Create new spreadsheet
                const spreadsheetId = await createNewSpreadsheet(mainTitle);
                appState.googleSheets.spreadsheetId = spreadsheetId;
                
                // Export attendees
                const attendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
                const attendeesData = attendees.map(attendee => [
                    attendee.name,
                    attendee.email,
                    attendee.phone,
                    attendee.account || '',
                    attendee.meetingTitle || '',
                    attendee.meetingDate || '',
                    attendee.departmentName || attendee.department || '',
                    attendee.registrationDate
                ]);
                
                await gapi.client.sheets.spreadsheets.batchUpdate({
                    spreadsheetId: spreadsheetId,
                    resource: {
                        requests: [
                            {
                                updateSheetProperties: {
                                    properties: {
                                        sheetId: 0,
                                        title: "Attendees"
                                    },
                                    fields: "title"
                                }
                            },
                            {
                                addSheet: {
                                    properties: {
                                        title: "Meetings"
                                    }
                                }
                            },
                            {
                                addSheet: {
                                    properties: {
                                        title: "Departments"
                                    }
                                }
                            },
                            {
                                addSheet: {
                                    properties: {
                                        title: "Summary"
                                    }
                                }
                            }
                        ]
                    }
                });
                
                // Update all sheets
                await updateSpreadsheet(spreadsheetId, "Attendees", 
                    ['Name', 'Email', 'Phone', 'Account', 'Meeting', 'Date', 'Department', 'Registration'], 
                    attendeesData);
                
                const meetings = JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]');
                const meetingsData = meetings.map(meeting => [
                    meeting.title,
                    meeting.date,
                    meeting.time,
                    meeting.department,
                    meeting.location,
                    meeting.status,
                    meeting.attendees ? meeting.attendees.length : 0,
                    meeting.maxAttendees || 'Unlimited'
                ]);
                
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: spreadsheetId,
                    range: 'Meetings!A1',
                    valueInputOption: 'RAW',
                    resource: {
                        values: [['Title', 'Date', 'Time', 'Department', 'Location', 'Status', 'Attendees', 'Max'], ...meetingsData]
                    }
                });
                
                const departments = JSON.parse(localStorage.getItem('bankMeetingDepartments') || '[]');
                const departmentsData = departments.map(dept => [
                    dept.name,
                    dept.head,
                    dept.email,
                    dept.phone || '',
                    dept.description || ''
                ]);
                
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: spreadsheetId,
                    range: 'Departments!A1',
                    valueInputOption: 'RAW',
                    resource: {
                        values: [['Department', 'Head', 'Email', 'Phone', 'Description'], ...departmentsData]
                    }
                });
                
                // Summary sheet
                const summaryData = [
                    ['Metric', 'Value'],
                    ['Total Attendees', attendees.length],
                    ['Total Meetings', meetings.length],
                    ['Total Departments', departments.length],
                    ['Active Meetings', meetings.filter(m => m.status === 'active').length],
                    ['Report Generated', new Date().toLocaleString()]
                ];
                
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: spreadsheetId,
                    range: 'Summary!A1',
                    valueInputOption: 'RAW',
                    resource: {
                        values: summaryData
                    }
                });
                
                const statusDiv = document.getElementById('google-sheets-status');
                statusDiv.innerHTML = `<i class="fas fa-check-circle"></i> All data exported successfully to Google Sheets!`;
                statusDiv.className = 'alert alert-success';
                showAlert('All data exported to Google Sheets successfully!', 'success');
                
            } catch (error) {
                console.error('Export all error:', error);
                const statusDiv = document.getElementById('google-sheets-status');
                statusDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> Export failed: ${error.message}`;
                statusDiv.className = 'alert alert-error';
                showAlert('Export to Google Sheets failed', 'error');
            }
        }

        // Update Google Sheets status display
        function updateGoogleSheetsStatus(message, type = 'info') {
            const statusDiv = document.getElementById('google-sheets-status');
            if (statusDiv) {
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${message}`;
                statusDiv.className = `alert alert-${type}`;
            }
        }

        // ==================== BACKUP FUNCTIONS ====================

        // Backup all data to JSON file
        function backupAllData() {
            const data = {
                backupDate: new Date().toISOString(),
                version: '1.0',
                meetings: JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]'),
                attendees: JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]'),
                departments: JSON.parse(localStorage.getItem('bankMeetingDepartments') || '[]'),
                admins: JSON.parse(localStorage.getItem('bankMeetingAdmins') || '[]')
            };
            
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            link.href = url;
            link.download = `bank_meeting_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            setTimeout(() => URL.revokeObjectURL(url), 100);
            showAlert('All data backed up successfully!', 'success');
        }

        // Restore from backup
        function restoreFromBackup(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.meetings) localStorage.setItem('bankMeetingMeetings', JSON.stringify(data.meetings));
                    if (data.attendees) localStorage.setItem('bankMeetingAttendees', JSON.stringify(data.attendees));
                    if (data.departments) localStorage.setItem('bankMeetingDepartments', JSON.stringify(data.departments));
                    if (data.admins) localStorage.setItem('bankMeetingAdmins', JSON.stringify(data.admins));
                    
                    loadDataFromLocalStorage();
                    updateAllData();
                    showAlert('Data restored successfully from backup!', 'success');
                } catch (error) {
                    showAlert('Invalid backup file format', 'error');
                }
            };
            reader.readAsText(file);
        }

        // ==================== SCHEDULED EXPORTS ====================

        // Setup scheduled exports
        function setupScheduledExports() {
            const frequency = document.getElementById('schedule-frequency').value;
            const type = document.getElementById('schedule-type').value;
            
            localStorage.setItem('exportSchedule', JSON.stringify({
                frequency,
                type,
                lastRun: null,
                enabled: true
            }));
            
            const statusDiv = document.getElementById('schedule-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = `<i class="fas fa-check-circle"></i> Export schedule saved: ${frequency} ${type} exports`;
            statusDiv.className = 'alert alert-success';
            
            showAlert(`Export schedule saved: ${frequency} ${type} exports`, 'success');
        }

        // Check and run scheduled exports
        function checkScheduledExports() {
            const schedule = JSON.parse(localStorage.getItem('exportSchedule') || '{}');
            if (!schedule.enabled) return;
            
            const now = new Date();
            const shouldRun = checkScheduleTime(schedule.frequency, schedule.lastRun);
            
            if (shouldRun) {
                runScheduledExport(schedule.type);
                schedule.lastRun = now.toISOString();
                localStorage.setItem('exportSchedule', JSON.stringify(schedule));
            }
        }

        // Check if it's time to run scheduled export
        function checkScheduleTime(frequency, lastRun) {
            if (!lastRun) return true;
            
            const lastRunDate = new Date(lastRun);
            const now = new Date();
            
            switch(frequency) {
                case 'daily':
                    return now.getDate() !== lastRunDate.getDate() && now.getHours() >= 17;
                case 'weekly':
                    return now.getDay() === 1 && now.getHours() >= 9 && 
                           (now.getDate() - lastRunDate.getDate() >= 7);
                case 'monthly':
                    return now.getDate() === 1 && now.getHours() >= 9;
                default:
                    return false;
            }
        }

        // Run scheduled export
        function runScheduledExport(type) {
            switch(type) {
                case 'attendees':
                    exportAllAttendeesCSV();
                    break;
                case 'meetings':
                    exportAllMeetingsCSV();
                    break;
                case 'summary':
                    generatePDFReport('summary');
                    break;
            }
            
            console.log(`Scheduled ${type} export completed at ${new Date().toLocaleString()}`);
        }

        // ==================== INITIALIZATION ====================

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Bank Meeting System initializing...');
            
            // Load data from localStorage
            loadDataFromLocalStorage();
            
            // Initialize real-time system
            realTimeSystem.init();
            
            // Initialize Google Sheets API (requires proper credentials)
            // initGoogleSheets();
            
            // Set up scheduled export check
            setInterval(checkScheduledExports, 60 * 60 * 1000); // Check every hour
            
            // Only show login page initially
            loginPage.style.display = 'block';
            loginPage.classList.add('active');
            dashboardPage.style.display = 'none';
            registrationPortal.style.display = 'none';
            
            // Setup login form
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    
                    // Find admin by email
                    const admin = appState.admins.find(a => a.email.toLowerCase() === email.toLowerCase());
                    
                    if (admin) {
                        // Check password
                        if (admin.password === password) {
                            // Update last login
                            admin.lastLogin = new Date().toLocaleString();
                            saveDataToLocalStorage();
                            
                            // Set current user
                            appState.currentUser = {
                                id: admin.id,
                                email: admin.email,
                                name: admin.name,
                                role: admin.role,
                                department: admin.department
                            };
                            
                            // Hide login page, show dashboard
                            loginPage.style.display = 'none';
                            loginPage.classList.remove('active');
                            dashboardPage.style.display = 'flex';
                            dashboardPage.classList.add('active');
                            
                            // Reset form
                            loginForm.reset();
                            
                            // Initialize dashboard
                            initializeDashboard();
                            
                            // Show welcome alert
                            showAlert(`Login successful! Welcome ${admin.name}.`, 'success');
                            
                            // Check for pending notifications
                            realTimeSystem.processNotificationQueue();
                        } else {
                            showLoginAlert('Invalid password. Please try again.');
                        }
                    } else {
                        showLoginAlert('No admin found with this email. Please check your credentials.');
                    }
                });
            }
            
            // Check if there's a QR code parameter in URL (simulating QR scan)
            checkForQRRegistration();
            
            console.log('Bank Meeting System loaded successfully!');
        });

        function showLoginAlert(message) {
            if (loginAlert) {
                loginAlert.textContent = message;
                loginAlert.style.display = 'block';
                loginAlert.className = 'alert alert-error';
                
                setTimeout(() => {
                    loginAlert.style.display = 'none';
                }, 5000);
            }
        }

        // Show alert function
        function showAlert(message, type = 'success') {
            if (alertContainer) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    ${message}
                `;
                alertContainer.innerHTML = '';
                alertContainer.appendChild(alertDiv);
                alertDiv.style.display = 'block';
                
                setTimeout(() => {
                    alertDiv.style.display = 'none';
                }, 5000);
            }
        }

     

        // Export Buttons
        document.getElementById('export-attendees-btn').addEventListener('click', exportAllAttendeesCSV);
        document.getElementById('export-all-meetings-btn').addEventListener('click', exportAllMeetingsCSV);
        document.getElementById('export-departments-btn').addEventListener('click', exportDepartmentsReportCSV);
        document.getElementById('export-pdf-btn').addEventListener('click', () => generatePDFReport('detailed'));
        
        // New Export Buttons in Reports section
        document.getElementById('export-attendees-full').addEventListener('click', exportAllAttendeesCSV);
        document.getElementById('export-meetings-summary').addEventListener('click', exportAllMeetingsCSV);
        document.getElementById('export-departments-report').addEventListener('click', exportDepartmentsReportCSV);
        document.getElementById('export-pdf-report').addEventListener('click', () => generateComprehensivePDFReport());
        document.getElementById('export-daily-report').addEventListener('click', () => generatePDFReport('summary'));
        document.getElementById('export-monthly-report').addEventListener('click', () => generatePDFReport('detailed'));
        
        // Google Sheets Buttons
        document.getElementById('connect-google-sheets').addEventListener('click', connectGoogleSheets);
        document.getElementById('export-to-sheets').addEventListener('click', () => {
            const type = document.getElementById('export-type').value;
            exportToGoogleSheets(type);
        });
        
        // Backup Button
        document.getElementById('backup-data-btn').addEventListener('click', backupAllData);
        
        // Schedule Buttons
        document.getElementById('save-schedule').addEventListener('click', setupScheduledExports);
        document.getElementById('test-schedule').addEventListener('click', () => {
            const type = document.getElementById('schedule-type').value;
            runScheduledExport(type);
        });
        
        // Export Options Modal
        document.getElementById('export-format').addEventListener('change', function() {
            const customRangeDiv = document.getElementById('custom-date-range');
            customRangeDiv.style.display = this.value === 'custom' ? 'block' : 'none';
        });
        
        document.getElementById('generate-export').addEventListener('click', function() {
            const format = document.getElementById('export-format').value;
            if (format === 'pdf') {
                generatePDFReport('detailed');
            } else if (format === 'csv') {
                exportAllAttendeesCSV();
            } else if (format === 'json') {
                backupAllData();
            }
            document.getElementById('export-options-modal').classList.add('hidden');
        });
    </script>
</body>
</html>