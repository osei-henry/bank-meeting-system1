<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Meeting System</title>
    <!-- Add cache-busting query string to force refresh -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?v=2">
    <script src="https://cdn.jsdelivr.net/npm/chart.js?v=2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js?v=2"></script>
    <!-- Add Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* CSS Embedded Directly in HTML */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --mustard: #FFDB58;
            --black: #000000;
            --white: #FFFFFF;
            --gray: #1a1a1a;
            --light-gray: #333333;
            --dark-gray: #0a0a0a;
            --border-color: #444444;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --info: #2196F3;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--black);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Page Transitions */
        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: block;
        }

        /* Server Status Indicator */
        .server-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .server-status.connected {
            background-color: var(--success);
            color: white;
        }
        
        .server-status.disconnected {
            background-color: var(--danger);
            color: white;
        }
        
        .server-status.syncing {
            background-color: var(--warning);
            color: white;
        }
        
        .server-status .spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Confirmation Modal */
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .confirmation-content {
            background-color: var(--gray);
            border-radius: 12px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
            text-align: center;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .confirmation-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .confirmation-icon.warning {
            color: var(--warning);
        }
        
        .confirmation-icon.danger {
            color: var(--danger);
        }
        
        .confirmation-icon.success {
            color: var(--success);
        }
        
        .confirmation-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--white);
        }
        
        .confirmation-message {
            color: #ccc;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        /* Export Options */
        .export-options {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid var(--mustard);
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        /* Server Controls */
        .server-controls {
            background: rgba(66, 133, 244, 0.1);
            border: 1px solid rgba(66, 133, 244, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        /* Login Page Styles */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)),
                        url('https://gapsghana.com/wp-content/uploads/2023/04/ssnit-1.jpg?v=1687987293');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .bank-logo {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bank-logo i {
            font-size: 4rem;
            color: var(--mustard);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .bank-logo h1 {
            font-size: 2.5rem;
            color: var(--white);
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .login-card {
            background-color: rgba(26, 26, 26, 0.95);
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            animation: slideUp 0.8s ease-out;
            backdrop-filter: blur(10px);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-card h2 {
            color: var(--white);
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 24px;
            animation: fadeIn 0.5s ease-out;
            animation-fill-mode: both;
        }

        .form-group:nth-child(1) {
            animation-delay: 0.2s;
        }

        .form-group:nth-child(2) {
            animation-delay: 0.4s;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--white);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            background-color: var(--light-gray);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--white);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        select.form-control {
            cursor: pointer;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--mustard);
            box-shadow: 0 0 0 2px rgba(255, 219, 88, 0.2);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--mustard);
            color: var(--black);
            width: 100%;
            animation: fadeIn 0.8s ease-out;
            animation-fill-mode: both;
            animation-delay: 0.6s;
        }

        .btn-primary:hover {
            background-color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 219, 88, 0.3);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--mustard);
            border: 1px solid var(--mustard);
        }

        .btn-secondary:hover {
            background-color: rgba(255, 219, 88, 0.1);
        }

        .btn-danger {
            background-color: var(--danger);
            color: var(--white);
        }

        .btn-success {
            background-color: var(--success);
            color: var(--white);
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--white);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Dashboard Layout */
        #dashboard-page {
            display: none;
            min-height: 100vh;
        }

        #dashboard-page.active {
            display: flex;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: var(--dark-gray);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .bank-logo-small {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .bank-logo-small i {
            font-size: 1.8rem;
            color: var(--mustard);
        }

        .bank-logo-small h2 {
            font-size: 1.2rem;
            color: var(--white);
            font-weight: 600;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background-color: var(--gray);
            border-radius: 6px;
        }

        .admin-info i {
            color: var(--mustard);
            font-size: 1.2rem;
        }

        .admin-info span {
            font-size: 0.9rem;
            color: var(--white);
        }

        .nav-menu {
            list-style: none;
            padding: 20px 0;
            flex-grow: 1;
        }

        .nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #999;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background-color: var(--gray);
            color: var(--white);
        }

        .nav-item.active {
            background-color: var(--gray);
            color: var(--mustard);
            border-left-color: var(--mustard);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .nav-item span {
            font-weight: 500;
        }

        #logout-btn {
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            color: #ff6b6b;
        }

        #logout-btn:hover {
            color: #ff5252;
            background-color: rgba(255, 107, 107, 0.1);
        }

        /* Main Content Area */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.9)),
                        url('https://internationalbanker.com/wp-content/uploads/2018/10/Banking-Hall-of-UMB-East-Legon-Branch..jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .main-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(5px);
        }

        .main-header h1 {
            font-size: 1.8rem;
            color: var(--white);
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .page-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .hidden {
            display: none !important;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: rgba(26, 26, 26, 0.9);
            border-radius: 10px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--mustard);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 219, 88, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-icon i {
            font-size: 1.8rem;
            color: var(--mustard);
        }

        .stat-info h3 {
            font-size: 2.2rem;
            color: var(--white);
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: #999;
            font-size: 0.95rem;
        }

        /* Content Card */
        .content-card {
            background-color: rgba(26, 26, 26, 0.9);
            border-radius: 10px;
            padding: 25px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .content-card h3 {
            color: var(--white);
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .content-card h3 i {
            color: var(--mustard);
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background-color: var(--light-gray);
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            color: var(--white);
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            color: #ccc;
        }

        .data-table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status.active {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .status.completed {
            background-color: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }

        .status.pending {
            background-color: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }

        .status.cancelled {
            background-color: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background-color: var(--gray);
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-lg {
            max-width: 800px;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: var(--white);
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--white);
            font-size: 2rem;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: var(--mustard);
        }

        .modal-body {
            padding: 30px;
        }

        /* Form Grid */
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        /* QR Container */
        .qr-container {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        #qrcode {
            width: 200px;
            height: 200px;
            background-color: white;
            border-radius: 8px;
            padding: 10px;
        }

        .qr-info {
            flex-grow: 1;
            min-width: 300px;
        }

        .qr-info h3 {
            color: var(--white);
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .qr-info p {
            color: #999;
            margin-bottom: 20px;
        }

        .qr-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Chart Container */
        .chart-container {
            background-color: var(--gray);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            height: 300px;
            position: relative;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #999;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: var(--mustard);
            border-bottom-color: var(--mustard);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Alert Messages */
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 4px solid var(--success);
            color: #4caf50;
        }

        .alert-error {
            background-color: rgba(244, 67, 54, 0.2);
            border-left: 4px solid var(--danger);
            color: #F44336;
        }

        /* Badge */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .badge-warning {
            background-color: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }

        /* QR Registration Portal Styles */
        .registration-portal {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.9)),
                        url('https://internationalbanker.com/wp-content/uploads/2018/10/Banking-Hall-of-UMB-East-Legon-Branch..jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .registration-card {
            background-color: rgba(26, 26, 26, 0.95);
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .registration-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .registration-header h2 {
            color: var(--mustard);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .registration-header p {
            color: #999;
            font-size: 1rem;
        }

        /* Meeting Info Section */
        .meeting-info {
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid var(--mustard);
        }

        .meeting-info h3 {
            color: var(--mustard);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .meeting-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ccc;
        }

        .detail-item i {
            color: var(--mustard);
            width: 20px;
        }

        /* Success Message */
        .success-message {
            text-align: center;
            padding: 40px;
        }

        .success-message i {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 20px;
        }

        .success-message h3 {
            color: var(--mustard);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .success-message p {
            color: #ccc;
            margin-bottom: 10px;
        }

        .demo-notice {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 219, 88, 0.1);
            border-radius: 6px;
            border-left: 4px solid var(--mustard);
            text-align: center;
        }

        .demo-notice p {
            color: var(--mustard);
            font-size: 0.9rem;
        }

        /* Meeting Summary Cards */
        .meeting-summary-card {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--mustard);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .meeting-summary-card:hover {
            transform: translateX(5px);
            border-left-color: var(--success);
        }

        /* View Attendee Modal */
        .attendee-details-modal .modal-content {
            max-width: 500px;
        }

        .attendee-info {
            display: grid;
            gap: 15px;
        }

        .attendee-info-item {
            padding: 10px;
            background: var(--light-gray);
            border-radius: 6px;
            border-left: 4px solid var(--mustard);
        }

        .attendee-info-item label {
            display: block;
            color: var(--mustard);
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .attendee-info-item p {
            color: var(--white);
            font-size: 1rem;
        }

        /* Restricted Access Styles */
        .restricted-access {
            text-align: center;
            padding: 40px;
            background: var(--light-gray);
            border-radius: 10px;
            border: 2px solid var(--danger);
        }

        .restricted-access i {
            font-size: 3rem;
            color: var(--danger);
            margin-bottom: 20px;
        }

        .restricted-access h3 {
            color: var(--white);
            margin-bottom: 10px;
        }

        .restricted-access p {
            color: #ccc;
        }

        /* Real-time Notification */
        .real-time-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease-out;
            max-width: 350px;
            cursor: pointer;
        }

        .real-time-notification:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .real-time-notification i {
            font-size: 24px;
        }

        .real-time-notification-content {
            flex-grow: 1;
        }

        .real-time-notification-content strong {
            display: block;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .real-time-notification-content p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .real-time-notification-time {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        /* Live Registration Counter */
        .live-registration-counter {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: var(--info);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9998;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            animation: slideInRight 0.5s ease-out;
        }

        .live-registration-counter i {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Backup History Styles */
        .backup-history-list {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            background: var(--dark-gray);
            border-radius: 6px;
            padding: 10px;
        }

        .backup-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s ease;
        }

        .backup-item:hover {
            background-color: var(--light-gray);
        }

        .backup-item:last-child {
            border-bottom: none;
        }

        .backup-info {
            flex-grow: 1;
        }

        .backup-info .backup-name {
            color: var(--white);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .backup-info .backup-meta {
            color: #999;
            font-size: 12px;
        }

        /* CSV Import Styles */
        .csv-import-section {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .csv-import-section h4 {
            color: var(--success);
            margin-bottom: 15px;
        }

        .csv-import-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .nav-item span,
            .bank-logo-small h2,
            .admin-info span {
                display: none;
            }
            
            .bank-logo-small {
                justify-content: center;
            }
            
            .nav-item {
                justify-content: center;
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .qr-container {
                flex-direction: column;
                text-align: center;
            }
            
            .qr-actions {
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .registration-card {
                padding: 30px 20px;
            }
            
            .meeting-details {
                grid-template-columns: 1fr;
            }
            
            .meeting-summary-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .meeting-summary-card .btn {
                align-self: flex-end;
            }
            
            .real-time-notification,
            .live-registration-counter {
                left: 20px;
                right: 20px;
                max-width: calc(100% - 40px);
            }
            
            .server-status {
                left: 20px;
                right: 20px;
                bottom: 10px;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .export-buttons .btn {
                width: 100%;
            }
            
            .confirmation-content {
                padding: 20px;
            }
            
            .confirmation-buttons {
                flex-direction: column;
            }
            
            .csv-import-options {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 30px 20px;
            }
            
            .main-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
            }
            
            .btn {
                width: 100%;
            }
            
            .modal-content {
                padding: 10px;
            }
            
            .registration-card {
                padding: 20px 15px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="confirmation-modal hidden">
        <div class="confirmation-content">
            <div id="confirmation-icon" class="confirmation-icon warning">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 id="confirmation-title" class="confirmation-title">Confirm Action</h3>
            <p id="confirmation-message" class="confirmation-message">Are you sure you want to perform this action?</p>
            <div class="confirmation-buttons">
                <button id="confirm-cancel" class="btn btn-secondary">Cancel</button>
                <button id="confirm-ok" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="confirmation-modal hidden">
        <div class="confirmation-content">
            <div class="confirmation-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="confirmation-title">Success!</h3>
            <p id="success-message-text" class="confirmation-message">Operation completed successfully.</p>
            <div class="confirmation-buttons">
                <button id="success-ok" class="btn btn-success">OK</button>
            </div>
        </div>
    </div>

    <!-- Server Status Indicator -->
    <div id="server-status" class="server-status disconnected">
        <i class="fas fa-server"></i>
        <span id="server-status-text">Server: Disconnected</span>
    </div>

    <!-- Login Page (Initially Active) -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="bank-logo">
                <i class="fas fa-university"></i>
                <h1>Bank Meeting System</h1>
            </div>
            <div class="login-card">
                <h2>Admin Login</h2>
                <div id="login-alert" class="alert alert-error" style="display: none;"></div>
                <form id="login-form">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" class="form-control" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard Page (Initially Hidden) -->
    <div id="dashboard-page" class="page">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="bank-logo-small">
                    <i class="fas fa-university"></i>
                    <h2>Bank Admin</h2>
                </div>
                <div class="admin-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="current-admin-email">Loading...</span>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="meetings">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Meetings</span>
                </li>
                <li class="nav-item" data-page="attendees">
                    <i class="fas fa-users"></i>
                    <span>Attendees</span>
                </li>
                <li class="nav-item" data-page="export">
                    <i class="fas fa-download"></i>
                    <span>Export & Backup</span>
                </li>
                <li class="nav-item" data-page="departments">
                    <i class="fas fa-building"></i>
                    <span>Departments</span>
                </li>
                <li class="nav-item" data-page="admins">
                    <i class="fas fa-user-shield"></i>
                    <span>Admins</span>
                </li>
                <li class="nav-item" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="main-header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" id="create-meeting-btn">
                        <i class="fas fa-plus"></i> New Meeting
                    </button>
                    <button class="btn btn-secondary" id="sync-data-btn">
                        <i class="fas fa-sync"></i> Sync to Server
                    </button>
                </div>
            </header>

            <!-- Alert Container -->
            <div id="alert-container" style="padding: 0 30px;"></div>

            <!-- Dashboard Content -->
            <div class="page-content" id="dashboard-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-meetings">0</h3>
                            <p>Active Meetings</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-attendees">0</h3>
                            <p>Total Attendees</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-departments">0</h3>
                            <p>Departments</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-server">Offline</h3>
                            <p>Server Status</p>
                        </div>
                    </div>
                </div>

                <!-- Server Controls -->
                <div class="server-controls">
                    <h4><i class="fas fa-server"></i> Supabase Connection</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="server-url">Supabase URL</label>
                            <input type="text" id="server-url" class="form-control" placeholder="https://your-project.supabase.co">
                        </div>
                        <div class="form-group">
                            <label for="supabase-key">Supabase Anon Key</label>
                            <input type="password" id="supabase-key" class="form-control" placeholder="eyJhbGciOiJIUzI1NiIs...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="auto-sync">Auto Sync</label>
                            <select id="auto-sync" class="form-control">
                                <option value="off">Off</option>
                                <option value="5">Every 5 minutes</option>
                                <option value="15">Every 15 minutes</option>
                                <option value="30">Every 30 minutes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="auto-backup">Auto Backup</label>
                            <select id="auto-backup" class="form-control">
                                <option value="0">Disabled</option>
                                <option value="60">Every hour</option>
                                <option value="360">Every 6 hours</option>
                                <option value="1440">Daily</option>
                            </select>
                        </div>
                    </div>
                    <div class="header-actions" style="margin-top: 10px;">
                        <button class="btn btn-success" id="connect-server-btn">
                            <i class="fas fa-plug"></i> Connect to Supabase
                        </button>
                        <button class="btn btn-warning" id="backup-now-btn">
                            <i class="fas fa-save"></i> Backup Now
                        </button>
                        <button class="btn btn-info" id="load-from-server-btn">
                            <i class="fas fa-download"></i> Load from Supabase
                        </button>
                    </div>
                </div>

                <div class="form-row">
                    <div class="content-card">
                        <h3><i class="fas fa-chart-line"></i> Meeting Attendance</h3>
                        <div class="chart-container">
                            <canvas id="attendanceChart"></canvas>
                        </div>
                    </div>
                    <div class="content-card">
                        <h3><i class="fas fa-chart-pie"></i> Department Distribution</h3>
                        <div class="chart-container">
                            <canvas id="departmentChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <h3><i class="fas fa-history"></i> Recent Meetings</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Meeting Title</th>
                                    <th>Date & Time</th>
                                    <th>Department</th>
                                    <th>Attendees</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recent-meetings-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meetings Content -->
            <div class="page-content hidden" id="meetings-content">
                <div class="content-card">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="active-meetings">Active Meetings</button>
                        <button class="tab-btn" data-tab="past-meetings">Past Meetings</button>
                        <button class="tab-btn" data-tab="create-meeting">Create New Meeting</button>
                    </div>
                    
                    <div class="tab-content active" id="active-meetings">
                        <h3><i class="fas fa-calendar-check"></i> Active Meetings</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Date & Time</th>
                                    <th>Department</th>
                                    <th>Location</th>
                                    <th>Attendees</th>
                                    <th>QR Code</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="active-meetings-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="past-meetings">
                        <h3><i class="fas fa-history"></i> Past Meetings</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Date & Time</th>
                                    <th>Department</th>
                                    <th>Location</th>
                                    <th>Attendees</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="past-meetings-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="create-meeting">
                        <h3><i class="fas fa-plus-circle"></i> Create New Meeting</h3>
                        <form id="create-meeting-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="meeting-title">Meeting Title *</label>
                                    <input type="text" id="meeting-title" class="form-control" placeholder="Loan Consultation" required>
                                </div>
                                <div class="form-group">
                                    <label for="meeting-department">Department *</label>
                                    <select id="meeting-department" class="form-control" required>
                                        <option value="">Select Department</option>
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="meeting-date">Date *</label>
                                    <input type="date" id="meeting-date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="meeting-time">Time *</label>
                                    <input type="time" id="meeting-time" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="meeting-location">Location *</label>
                                    <input type="text" id="meeting-location" class="form-control" placeholder="Conference Room A" required>
                                </div>
                                <div class="form-group">
                                    <label for="meeting-duration">Duration (hours) *</label>
                                    <input type="number" id="meeting-duration" class="form-control" min="0.5" max="8" step="0.5" value="1" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="meeting-description">Description</label>
                                <textarea id="meeting-description" class="form-control" rows="3" placeholder="Meeting agenda and objectives"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="meeting-max-attendees">Maximum Attendees</label>
                                <input type="number" id="meeting-max-attendees" class="form-control" min="1" max="1000" placeholder="Leave empty for unlimited">
                            </div>
                            
                            <div class="header-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-calendar-plus"></i> Create Meeting
                                </button>
                                <button type="button" class="btn btn-success" id="save-meeting-server">
                                    <i class="fas fa-cloud-upload-alt"></i> Create & Save to Supabase
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Attendees Content -->
            <div class="page-content hidden" id="attendees-content">
                <div class="content-card">
                    <h3><i class="fas fa-users"></i> All Attendees</h3>
                    <div class="header-actions" style="margin-bottom: 20px;">
                        <button class="btn btn-success" id="export-attendees-btn">
                            <i class="fas fa-file-csv"></i> Export to CSV
                        </button>
                        <button class="btn btn-warning" id="export-server-attendees">
                            <i class="fas fa-download"></i> Download from Supabase
                        </button>
                        <button class="btn btn-primary" id="add-attendee-btn">
                            <i class="fas fa-user-plus"></i> Add Attendee
                        </button>
                        <button class="btn btn-info" id="sync-attendees-btn">
                            <i class="fas fa-cloud-upload-alt"></i> Sync to Supabase
                        </button>
                        <button class="btn btn-secondary" id="import-csv-btn">
                            <i class="fas fa-file-import"></i> Import CSV
                        </button>
                        <input type="file" id="csv-upload" accept=".csv" style="display: none;">
                    </div>
                    
                    <!-- CSV Import Section -->
                    <div class="csv-import-section hidden" id="csv-import-section">
                        <h4><i class="fas fa-file-import"></i> Import CSV Data</h4>
                        <p>Upload a CSV file to import attendees. CSV should have columns: Name, Email, Phone, Account, Meeting, Department, Purpose</p>
                        <div class="csv-import-options">
                            <div class="form-group">
                                <label for="csv-table-select">Import to Table</label>
                                <select id="csv-table-select" class="form-control">
                                    <option value="attendees">Attendees</option>
                                    <option value="meetings">Meetings</option>
                                    <option value="departments">Departments</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="csv-backup-first">Create Backup First</label>
                                <select id="csv-backup-first" class="form-control">
                                    <option value="yes">Yes (Recommended)</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>
                        <div class="header-actions" style="margin-top: 15px;">
                            <button class="btn btn-success" id="confirm-csv-upload">
                                <i class="fas fa-upload"></i> Upload & Import
                            </button>
                            <button class="btn btn-secondary" id="cancel-csv-upload">
                                Cancel
                            </button>
                        </div>
                    </div>
                    
                    <!-- Meeting Summary Section -->
                    <div class="content-card meetings-summary-card" style="margin-bottom: 20px;">
                        <h3><i class="fas fa-chart-bar"></i> Attendees by Meeting</h3>
                        <div id="meetings-summary">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Account No.</th>
                                <th>Meeting</th>
                                <th>Meeting Date</th>
                                <th>Department</th>
                                <th>Registration Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="attendees-table">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Export & Backup Content -->
            <div class="page-content hidden" id="export-content">
                <div class="content-card">
                    <h3><i class="fas fa-download"></i> Export & Backup Center</h3>
                    
                    <!-- Export Options -->
                    <div class="export-options">
                        <h4><i class="fas fa-file-export"></i> Export Data</h4>
                        <p>Select data to export to CSV files:</p>
                        
                        <div class="export-buttons">
                            <button class="btn btn-success" id="export-all-csv">
                                <i class="fas fa-file-csv"></i> All Attendees (CSV)
                            </button>
                            <button class="btn btn-warning" id="export-meetings-csv">
                                <i class="fas fa-calendar"></i> All Meetings (CSV)
                            </button>
                            <button class="btn btn-info" id="export-departments-csv">
                                <i class="fas fa-building"></i> Departments (CSV)
                            </button>
                            <button class="btn btn-secondary" id="export-admins-csv">
                                <i class="fas fa-user-shield"></i> Admins (CSV)
                            </button>
                        </div>
                    </div>
                    
                    <!-- Supabase Export -->
                    <div class="export-options" style="margin-top: 20px;">
                        <h4><i class="fas fa-server"></i> Supabase Export</h4>
                        <p>Export data from Supabase tables:</p>
                        
                        <div class="export-buttons">
                            <button class="btn btn-primary" id="export-server-attendees-2">
                                <i class="fas fa-download"></i> Supabase Attendees
                            </button>
                            <button class="btn btn-primary" id="export-server-meetings">
                                <i class="fas fa-download"></i> Supabase Meetings
                            </button>
                            <button class="btn btn-primary" id="export-server-departments">
                                <i class="fas fa-download"></i> Supabase Departments
                            </button>
                        </div>
                    </div>
                    
                    <!-- Backup Options -->
                    <div class="export-options" style="margin-top: 20px;">
                        <h4><i class="fas fa-save"></i> Backup & Restore</h4>
                        <p>Backup all data to JSON or restore from backup:</p>
                        
                        <div class="export-buttons">
                            <button class="btn btn-success" id="backup-json">
                                <i class="fas fa-file-export"></i> Backup to JSON
                            </button>
                            <button class="btn btn-warning" id="backup-server">
                                <i class="fas fa-cloud-upload-alt"></i> Backup to Supabase Storage
                            </button>
                            <button class="btn btn-info" id="restore-backup">
                                <i class="fas fa-file-import"></i> Restore from Backup
                            </button>
                            <input type="file" id="backup-file" accept=".json" style="display: none;">
                        </div>
                        
                        <!-- Backup History -->
                        <div class="backup-history" style="margin-top: 20px;">
                            <h5><i class="fas fa-history"></i> Recent Backups</h5>
                            <div class="backup-history-list" id="backup-history-list">
                                Loading backup history...
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <label for="auto-backup-select">Auto Backup Interval:</label>
                            <select id="auto-backup-select" class="form-control" style="margin-top: 5px;">
                                <option value="0">Disabled</option>
                                <option value="30">Every 30 minutes</option>
                                <option value="60">Every hour</option>
                                <option value="360">Every 6 hours</option>
                                <option value="1440">Daily</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Data Management -->
                    <div class="export-options" style="margin-top: 20px;">
                        <h4><i class="fas fa-database"></i> Data Management</h4>
                        <p>Manage your data between local storage and Supabase:</p>
                        
                        <div class="export-buttons">
                            <button class="btn btn-primary" id="sync-all-data">
                                <i class="fas fa-sync"></i> Sync All to Supabase
                            </button>
                            <button class="btn btn-secondary" id="load-all-server">
                                <i class="fas fa-download"></i> Load All from Supabase
                            </button>
                            <button class="btn btn-danger" id="clear-local-data">
                                <i class="fas fa-trash"></i> Clear Local Data
                            </button>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 10px; background: var(--dark-gray); border-radius: 5px;">
                            <p><strong>Data Status:</strong></p>
                            <p id="data-status">Loading...</p>
                            <p id="backup-stats">Loading backup statistics...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Departments Content -->
            <div class="page-content hidden" id="departments-content">
                <div class="content-card">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="view-departments">View Departments</button>
                        <button class="tab-btn" data-tab="add-department">Add Department</button>
                    </div>
                    
                    <div class="tab-content active" id="view-departments">
                        <h3><i class="fas fa-building"></i> All Departments</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Department Name</th>
                                    <th>Head</th>
                                    <th>Email</th>
                                    <th>Meetings</th>
                                    <th>Attendees</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="departments-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="add-department">
                        <!-- Restricted content for non-super admins -->
                        <div id="restricted-department-access" class="restricted-access hidden">
                            <i class="fas fa-lock"></i>
                            <h3>Restricted Access</h3>
                            <p>Only Super Admin can add new departments.</p>
                        </div>
                        
                        <!-- Department form (only visible to super admin) -->
                        <div id="department-form-container">
                            <h3><i class="fas fa-plus-circle"></i> Add New Department</h3>
                            <form id="add-department-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="department-name">Department Name/Branch *</label>
                                        <input type="text" id="department-name" class="form-control" placeholder="Loan Department" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="department-head">Department Head *</label>
                                        <input type="text" id="department-head" class="form-control" placeholder="John Doe" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="department-email">Email *</label>
                                        <input type="email" id="department-email" class="form-control" placeholder="loans@bank.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="department-phone">Phone</label>
                                        <input type="tel" id="department-phone" class="form-control" placeholder="+1234567890">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="department-description">Description</label>
                                    <textarea id="department-description" class="form-control" rows="3" placeholder="Department purpose and functions"></textarea>
                                </div>
                                
                                <div class="header-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-building"></i> Add Department
                                    </button>
                                    <button type="button" class="btn btn-success" id="save-department-server">
                                        <i class="fas fa-cloud-upload-alt"></i> Add & Save to Supabase
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admins Content -->
            <div class="page-content hidden" id="admins-content">
                <div class="content-card">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="view-admins">View Admins</button>
                        <button class="tab-btn" data-tab="add-admin">Add Admin</button>
                    </div>
                    
                    <div class="tab-content active" id="view-admins">
                        <h3><i class="fas fa-user-shield"></i> All Administrators</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Department</th>
                                    <th>Role</th>
                                    <th>Last Login</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admins-table">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="add-admin">
                        <!-- Restricted content for non-super admins -->
                        <div id="restricted-admin-access" class="restricted-access hidden">
                            <i class="fas fa-lock"></i>
                            <h3>Restricted Access</h3>
                            <p>Only Super Admin can add new administrators.</p>
                        </div>
                        
                        <!-- Admin form (only visible to super admin) -->
                        <div id="admin-form-container">
                            <h3><i class="fas fa-user-plus"></i> Add New Admin</h3>
                            <form id="add-admin-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="admin-name">Full Name *</label>
                                        <input type="text" id="admin-name" class="form-control" placeholder="John Doe" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-email">Email *</label>
                                        <input type="email" id="admin-email" class="form-control" placeholder="john@bank.com" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="admin-password">Password *</label>
                                        <input type="password" id="admin-password" class="form-control" placeholder="" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-department">Department *</label>
                                        <select id="admin-department" class="form-control" required>
                                            <option value="">Select Department</option>
                                            <!-- Will be populated by JavaScript -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="admin-role">Role *</label>
                                        <select id="admin-role" class="form-control" required>
                                            <option value="admin">Admin</option>
                                            <option value="super_admin">Super Admin</option>
                                            <option value="department_head">Department Head</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-phone">Phone</label>
                                        <input type="tel" id="admin-phone" class="form-control" placeholder="+1234567890">
                                    </div>
                                </div>
                                
                                <div class="header-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-user-plus"></i> Add Admin
                                    </button>
                                    <button type="button" class="btn btn-success" id="save-admin-server">
                                        <i class="fas fa-cloud-upload-alt"></i> Add & Save to Supabase
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- QR Registration Portal (Now a separate page) -->
    <div id="registration-portal" class="page">
        <div class="registration-portal">
            <div class="bank-logo">
                <i class="fas fa-university"></i>
                <h1>UMB Bank Meeting Registration</h1>
            </div>
            
            <div class="registration-card">
                <!-- Alert Messages -->
                <div id="qr-alert-container"></div>
                
                <!-- Registration Form -->
                <div id="registration-form-container">
                    <div class="registration-header">
                        <h2 id="meeting-title-display">Meeting Registration</h2>
                        <p id="meeting-subtitle-display">Scan the QR code to register for this meeting</p>
                    </div>
                    
                    <!-- Meeting Information -->
                    <div class="meeting-info">
                        <h3 id="current-meeting-title">Loading meeting details...</h3>
                        <div class="meeting-details">
                            <div class="detail-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span id="meeting-date-display">Loading...</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-clock"></i>
                                <span id="meeting-time-display">Loading...</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span id="meeting-location-display">Loading...</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-building"></i>
                                <span id="meeting-department-display">Loading...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Registration Form -->
                    <form id="attendee-registration-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="full-name">Full Name *</label>
                                <input type="text" id="full-name" class="form-control" placeholder="Enter your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone-number">Phone Number *</label>
                                <input type="tel" id="phone-number" class="form-control" placeholder="+1 (234) 567-8900" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email-address">Email Address *</label>
                                <input type="email" id="email-address" class="form-control" placeholder="your.email@example.com" required>
                            </div>
                            <div class="form-group">
                                <label for="bank-account">Bank Account Number (Optional)</label>
                                <input type="text" id="bank-account" class="form-control" placeholder="Account number if applicable">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="department">Department *</label>
                                <select id="department" class="form-control" required>
                                    <option value="">Select Department</option>
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="purpose">Purpose of Meeting *</label>
                                <select id="purpose" class="form-control" required>
                                    <option value="">Select Purpose</option>
                                    <option value="loan_consultation">Loan Consultation</option>
                                    <option value="account_opening">Account Opening</option>
                                    <option value="investment">Investment Advice</option>
                                    <option value="business">Business Banking</option>
                                    <option value="mortgage">Mortgage Inquiry</option>
                                    <option value="credit_card">Credit Card Application</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="additional-notes">Additional Notes</label>
                            <textarea id="additional-notes" class="form-control" rows="3" placeholder="Any special requirements or questions"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check-circle"></i> Submit Registration
                        </button>
                    </form>
                </div>
                
                <!-- Success Message - MODIFIED: Removed buttons -->
                <div class="success-message" id="success-message" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <h3>Registration Successful!</h3>
                    <p>Thank you for registering for the meeting. Your details have been saved successfully.</p>
                    <p>You will receive a confirmation email shortly.</p>
                    <div style="margin-top: 20px;">
                        <p style="color: var(--mustard); font-weight: bold;">
                            <i class="fas fa-info-circle"></i> Your registration is now complete.
                        </p>
                    </div>
                </div>
                
                <!-- Demo Notice -->
                <div class="demo-notice">
                    <p><i class="fas fa-info-circle"></i> UMB Bank Meeting Registration System</p>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qr-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Meeting QR Code</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="qr-container">
                    <div id="qrcode"></div>
                    <div class="qr-info">
                        <h3 id="qr-meeting-title">Meeting Title</h3>
                        <p><strong>Date:</strong> <span id="qr-meeting-date">Loading...</span></p>
                        <p><strong>Time:</strong> <span id="qr-meeting-time">Loading...</span></p>
                        <p><strong>Location:</strong> <span id="qr-meeting-location">Loading...</span></p>
                        <p><strong>Registration Link:</strong> <br><small id="qr-meeting-link">Loading...</small></p>
                        <p class="demo-notes"><i class="fas fa-info-circle"></i> Scan this QR code to register for the meeting</p>
                        <div class="qr-actions">
                            <button class="btn btn-primary" id="download-qr-btn">
                                <i class="fas fa-download"></i> Download QR
                            </button>
                            <button class="btn btn-secondary" id="copy-link-btn">
                                <i class="fas fa-copy"></i> Copy Link
                            </button>
                            <button class="btn btn-success" id="send-email-btn">
                                <i class="fas fa-envelope"></i> Send Email
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Meeting Details Modal -->
    <div id="meeting-details-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Meeting Details</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="meeting-details-content">
                    <!-- Meeting details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Meeting Modal -->
    <div id="edit-meeting-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Meeting</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-meeting-form">
                    <input type="hidden" id="edit-meeting-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-meeting-title">Meeting Title *</label>
                            <input type="text" id="edit-meeting-title" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-meeting-department">Department *</label>
                            <select id="edit-meeting-department" class="form-control" required>
                                <option value="">Select Department</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-meeting-date">Date *</label>
                            <input type="date" id="edit-meeting-date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-meeting-time">Time *</label>
                            <input type="time" id="edit-meeting-time" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-meeting-location">Location *</label>
                            <input type="text" id="edit-meeting-location" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-meeting-duration">Duration (hours) *</label>
                            <input type="number" id="edit-meeting-duration" class="form-control" min="0.5" max="8" step="0.5" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-meeting-description">Description</label>
                        <textarea id="edit-meeting-description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-meeting-max-attendees">Maximum Attendees</label>
                        <input type="number" id="edit-meeting-max-attendees" class="form-control" min="1" max="1000">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-meeting-status">Status *</label>
                        <select id="edit-meeting-status" class="form-control" required>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Attendee Modal -->
    <div id="add-attendee-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Attendee</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="manual-attendee-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="manual-attendee-name">Full Name *</label>
                            <input type="text" id="manual-attendee-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="manual-attendee-email">Email Address *</label>
                            <input type="email" id="manual-attendee-email" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="manual-attendee-phone">Phone Number *</label>
                            <input type="tel" id="manual-attendee-phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="manual-attendee-account">Bank Account Number</label>
                            <input type="text" id="manual-attendee-account" class="form-control" placeholder="Optional">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="manual-attendee-meeting">Meeting *</label>
                            <select id="manual-attendee-meeting" class="form-control" required>
                                <option value="">Select Meeting</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="manual-attendee-purpose">Purpose of Meeting *</label>
                            <select id="manual-attendee-purpose" class="form-control" required>
                                <option value="">Select Purpose</option>
                                <option value="loan_consultation">Loan Consultation</option>
                                <option value="account_opening">Account Opening</option>
                                <option value="investment">Investment Advice</option>
                                <option value="business">Business Banking</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="manual-attendee-notes">Additional Notes</label>
                        <textarea id="manual-attendee-notes" class="form-control" rows="2" placeholder="Any special requirements or notes"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Add Attendee
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- View Attendee Details Modal -->
    <div id="view-attendee-modal" class="modal hidden attendee-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Attendee Details</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="attendee-info" id="attendee-details-content">
                    <!-- Attendee details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Department Modal -->
    <div id="edit-department-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Department</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-department-form">
                    <input type="hidden" id="edit-department-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-department-name">Department Name *</label>
                            <input type="text" id="edit-department-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-department-head">Department Head *</label>
                            <input type="text" id="edit-department-head" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-department-email">Email *</label>
                            <input type="email" id="edit-department-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-department-phone">Phone</label>
                            <input type="tel" id="edit-department-phone" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-department-description">Description</label>
                        <textarea id="edit-department-description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Backup Restore Modal -->
    <div id="backup-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Backup & Restore</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <h4><i class="fas fa-info-circle"></i> Backup Information</h4>
                    <div id="backup-info">
                        <!-- Backup info will be shown here -->
                    </div>
                    
                    <div class="header-actions" style="margin-top: 20px;">
                        <button class="btn btn-success" id="confirm-backup">
                            <i class="fas fa-check"></i> Confirm Backup
                        </button>
                        <button class="btn btn-secondary" id="cancel-backup">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Backup Modal -->
    <div id="restore-backup-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Restore Backup</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="restore-backup-list">
                    <!-- Backup list will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- CSV Import Instructions Modal -->
    <div id="csv-instructions-modal" class="modal hidden">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>CSV Import Instructions</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <h4><i class="fas fa-file-csv"></i> CSV Format Requirements</h4>
                    
                    <div style="margin: 20px 0;">
                        <h5>For Attendees CSV:</h5>
                        <pre style="background: var(--dark-gray); padding: 15px; border-radius: 5px; overflow-x: auto;">
Name,Email,Phone,Account Number,Meeting,Department,Purpose,Notes
"John Doe","john@email.com","+1234567890","ACC001234","Loan Consultation","Loan Department","loan_consultation","Interested in home loan"
"Jane Smith","jane@email.com","+1234567891","ACC001235","Investment Seminar","Investment Banking","investment","Retirement planning"
                        </pre>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h5>For Meetings CSV:</h5>
                        <pre style="background: var(--dark-gray); padding: 15px; border-radius: 5px; overflow-x: auto;">
Title,Department,Date,Time,Location,Duration,Description,Max Attendees,Status
"Loan Consultation","Loan Department","2024-01-15","10:00","Conference Room A",1.0,"Personal loan consultation",10,"active"
"Investment Seminar","Investment Banking","2024-01-16","14:00","Auditorium",2.0,"Quarterly investment seminar",50,"active"
                        </pre>
                    </div>
                    
                    <div class="header-actions" style="margin-top: 20px;">
                        <button class="btn btn-success" id="download-csv-template">
                            <i class="fas fa-download"></i> Download CSV Template
                        </button>
                        <button class="btn btn-primary" id="close-csv-instructions">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== SUPABASE CONFIGURATION ====================
        // Replace these with your actual Supabase credentials
        const DEFAULT_SUPABASE_URL = 'https://jnimtlyymxykufmaykdm.supabase.co';
        const DEFAULT_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuaW10bHl5bXh5a3VmbWF5a2RtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3ODA3MTQsImV4cCI6MjA4MzM1NjcxNH0.b5huSUA1Pvh0QeIGU1LmzHwR3diQafqNrxqR-r_9mlM';
        
        // Initialize Supabase client
        let supabase = null;
        let realtimeSubscriptions = [];
        let autoSyncInterval = null;
        let autoBackupInterval = null;

        // ==================== APPLICATION STATE ====================
        const appState = {
            currentUser: null,
            meetings: [],
            attendees: [],
            departments: [],
            admins: [],
            charts: {},
            serverStats: {
                lastSync: null,
                serverAttendees: 0,
                serverMeetings: 0,
                serverDepartments: 0
            },
            pendingAction: null,
            supabaseConnected: false
        };

        // ==================== INITIALIZE SUPABASE ====================
        function initializeSupabase() {
            try {
                const supabaseUrl = localStorage.getItem('supabase_url') || DEFAULT_SUPABASE_URL;
                const supabaseKey = localStorage.getItem('supabase_key') || DEFAULT_SUPABASE_KEY;
                
                // Update UI with saved credentials
                const urlInput = document.getElementById('server-url');
                const keyInput = document.getElementById('supabase-key');
                if (urlInput) urlInput.value = supabaseUrl;
                if (keyInput) keyInput.value = supabaseKey;
                
                // Initialize Supabase client
                supabase = supabase.createClient(supabaseUrl, supabaseKey, {
                    auth: {
                        autoRefreshToken: true,
                        persistSession: true,
                        detectSessionInUrl: true
                    },
                    realtime: {
                        params: {
                            eventsPerSecond: 10
                        }
                    }
                });
                
                console.log('Supabase initialized');
                return true;
            } catch (error) {
                console.error('Error initializing Supabase:', error);
                updateServerStatus(false);
                return false;
            }
        }

        // ==================== SUPABASE CONNECTION ====================
        async function testSupabaseConnection() {
            try {
                if (!supabase) {
                    if (!initializeSupabase()) {
                        throw new Error('Failed to initialize Supabase client');
                    }
                }
                
                updateServerStatus('syncing');
                
                // Test connection with a simple query
                const { data, error } = await supabase
                    .from('admins')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    // If the admins table doesn't exist, try creating it
                    console.log('Admins table might not exist, trying to create demo data...');
                    await createDemoDataInSupabase();
                    
                    // Try query again
                    const { data: newData, error: newError } = await supabase
                        .from('admins')
                        .select('count')
                        .limit(1);
                    
                    if (newError) throw newError;
                }
                
                console.log('Supabase connected successfully');
                appState.supabaseConnected = true;
                updateServerStatus(true);
                
                // Save credentials to localStorage
                localStorage.setItem('supabase_url', document.getElementById('server-url')?.value || DEFAULT_SUPABASE_URL);
                localStorage.setItem('supabase_key', document.getElementById('supabase-key')?.value || DEFAULT_SUPABASE_KEY);
                
                return true;
            } catch (error) {
                console.error('Supabase connection error:', error);
                appState.supabaseConnected = false;
                updateServerStatus(false);
                return false;
            }
        }

        // ==================== CREATE DEMO DATA IN SUPABASE ====================
        async function createDemoDataInSupabase() {
            try {
                console.log('Creating demo data in Supabase...');
                
                // Create tables if they don't exist (simplified approach)
                // In a real app, you'd have proper SQL migrations
                const demoAdmins = [
                    { 
                        name: 'Henry Ghansah', 
                        email: 'ghansah.henry@myumbbank.com', 
                        department: 'Loan Department', 
                        role: 'super_admin', 
                        phone: '+1234567893', 
                        password: 'Windows@@055020',
                        last_login: new Date().toISOString(), 
                        status: 'active',
                        created_at: new Date().toISOString()
                    }
                ];
                
                // Insert demo admin
                const { error: adminError } = await supabase
                    .from('admins')
                    .upsert(demoAdmins);
                
                if (adminError) {
                    console.log('Note: Could not insert admin data, table might not exist yet.');
                }
                
                return true;
            } catch (error) {
                console.error('Error creating demo data:', error);
                return false;
            }
        }

        // ==================== REAL-TIME UPDATES ====================
        async function initializeRealtimeUpdates() {
            if (!appState.supabaseConnected || !supabase) return;
            
            console.log("Initializing real-time updates...");
            
            // Unsubscribe from existing subscriptions
            realtimeSubscriptions.forEach(sub => {
                supabase.removeChannel(sub);
            });
            realtimeSubscriptions = [];
            
            // Subscribe to new attendees
            try {
                const attendeesChannel = supabase
                    .channel('new-attendees')
                    .on(
                        'postgres_changes',
                        {
                            event: 'INSERT',
                            schema: 'public',
                            table: 'attendees'
                        },
                        (payload) => {
                            console.log('New attendee registered:', payload.new);
                            showRealtimeNotification({
                                type: 'new_registration',
                                title: 'New Registration',
                                message: `${payload.new.name} registered for ${payload.new.meeting_title}`,
                                data: payload.new
                            });
                            
                            // Update local state
                            const exists = appState.attendees.some(a => a.id === payload.new.id);
                            if (!exists) {
                                appState.attendees.unshift(payload.new);
                                updateStats();
                                updateAttendeesPage();
                            }
                        }
                    )
                    .subscribe();
                
                realtimeSubscriptions.push(attendeesChannel);
                
                // Subscribe to meeting updates
                const meetingsChannel = supabase
                    .channel('meeting-updates')
                    .on(
                        'postgres_changes',
                        {
                            event: '*',
                            schema: 'public',
                            table: 'meetings'
                        },
                        (payload) => {
                            console.log('Meeting updated:', payload);
                            
                            if (payload.eventType === 'INSERT') {
                                appState.meetings.unshift(payload.new);
                            } else if (payload.eventType === 'UPDATE') {
                                const index = appState.meetings.findIndex(m => m.id === payload.new.id);
                                if (index !== -1) {
                                    appState.meetings[index] = payload.new;
                                }
                            } else if (payload.eventType === 'DELETE') {
                                appState.meetings = appState.meetings.filter(m => m.id !== payload.old.id);
                            }
                            
                            updateStats();
                            updateMeetingsPage();
                            updateDashboard();
                        }
                    )
                    .subscribe();
                
                realtimeSubscriptions.push(meetingsChannel);
                
                // Live registration counter
                updateLiveRegistrationCounter();
                setInterval(updateLiveRegistrationCounter, 30000);
                
                console.log("Real-time updates initialized");
            } catch (error) {
                console.error('Error initializing real-time updates:', error);
            }
        }

        // ==================== SIMPLE LOGIN SYSTEM ====================
        async function simpleLogin(email, password) {
            try {
                console.log('Attempting login with:', email);
                
                // Load admins from localStorage first
                loadDataFromLocalStorage();
                
                // Check if we have demo data
                if (appState.admins.length === 0) {
                    console.log('No admins found, initializing demo data...');
                    initializeDemoData();
                    loadDataFromLocalStorage();
                }
                
                // Find admin by email
                const admin = appState.admins.find(a => a.email === email);
                
                if (!admin) {
                    console.log('Admin not found:', email);
                    return { success: false, error: 'Invalid email or password' };
                }
                
                // Check password (in a real app, use proper password hashing)
                if (admin.password !== password) {
                    console.log('Password mismatch for:', email);
                    return { success: false, error: 'Invalid email or password' };
                }
                
                // Update last login
                admin.lastLogin = new Date().toISOString();
                saveDataToLocalStorage();
                
                // Set current user
                appState.currentUser = {
                    id: admin.id,
                    email: admin.email,
                    name: admin.name,
                    role: admin.role,
                    department: admin.department
                };
                
                // Save to localStorage for persistence
                localStorage.setItem('current_admin', JSON.stringify(appState.currentUser));
                
                console.log('Login successful for:', email);
                return { success: true, user: admin };
                
            } catch (error) {
                console.error('Login error:', error);
                return { success: false, error: 'Login failed: ' + error.message };
            }
        }

        // ==================== LOGOUT ====================
        function simpleLogout() {
            try {
                localStorage.removeItem('current_admin');
                appState.currentUser = null;
                
                // Stop real-time updates
                if (supabase && realtimeSubscriptions.length > 0) {
                    realtimeSubscriptions.forEach(sub => {
                        supabase.removeChannel(sub);
                    });
                    realtimeSubscriptions = [];
                }
                
                return { success: true };
            } catch (error) {
                console.error('Logout error:', error);
                return { success: false, error: error.message };
            }
        }

        // ==================== CHECK EXISTING SESSION ====================
        function checkExistingSession() {
            try {
                const savedAdmin = localStorage.getItem('current_admin');
                if (savedAdmin) {
                    const admin = JSON.parse(savedAdmin);
                    appState.currentUser = admin;
                    
                    // Show dashboard if user is already logged in
                    if (appState.currentUser) {
                        document.getElementById('login-page').classList.remove('active');
                        document.getElementById('dashboard-page').classList.add('active');
                        
                        // Update admin email display
                        const adminEmailSpan = document.getElementById('current-admin-email');
                        if (adminEmailSpan) {
                            adminEmailSpan.textContent = appState.currentUser.email;
                        }
                        
                        // Initialize dashboard
                        initializeDashboard();
                        
                        // Try to connect to Supabase in background
                        testSupabaseConnection().then(connected => {
                            if (connected) {
                                initializeRealtimeUpdates();
                            }
                        });
                        
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.error('Error checking session:', error);
                return false;
            }
        }

        // ==================== DATA MANAGEMENT ====================
        function initializeDemoData() {
            console.log("Initializing demo data...");
            
            // Demo departments
            appState.departments = [
                { id: 1, name: 'Loan Department', head: 'John Manager', email: 'loans@bank.com', phone: '+1234567890', description: 'Handles all loan applications and consultations', createdAt: '2024-01-01' },
                { id: 2, name: 'Investment Banking', head: 'Sarah Investor', email: 'investments@bank.com', phone: '+1234567891', description: 'Investment advice and portfolio management', createdAt: '2024-01-01' },
                { id: 3, name: 'Customer Service', head: 'Mike Support', email: 'support@bank.com', phone: '+1234567892', description: 'Customer support and general inquiries', createdAt: '2024-01-01' },
                { id: 4, name: 'Mortgage Services', head: 'Emma Home', email: 'mortgage@bank.com', phone: '+1234567893', description: 'Mortgage and home loan services', createdAt: '2024-01-01' },
                { id: 5, name: 'Credit Card Division', head: 'Robert Card', email: 'creditcard@bank.com', phone: '+1234567894', description: 'Credit card applications and services', createdAt: '2024-01-01' }
            ];

            // Demo admins WITH CORRECT PASSWORD
            appState.admins = [
                { 
                    id: 1, 
                    name: 'Henry Ghansah', 
                    email: 'ghansah.henry@myumbbank.com', 
                    department: 'Loan Department', 
                    role: 'super_admin', 
                    phone: '+1234567893', 
                    password: 'Windows@@055020',
                    lastLogin: '2024-01-15 10:30:00', 
                    status: 'active',
                    createdAt: '2024-01-01'
                },
                { 
                    id: 2, 
                    name: 'John Manager', 
                    email: 'john@bank.com', 
                    department: 'Loan Department', 
                    role: 'admin', 
                    phone: '+1234567894', 
                    password: 'admin123',
                    lastLogin: '2024-01-14 14:20:00', 
                    status: 'active',
                    createdAt: '2024-01-01'
                },
                { 
                    id: 3, 
                    name: 'Sarah Investor', 
                    email: 'sarah@bank.com', 
                    department: 'Investment Banking', 
                    role: 'department_head', 
                    phone: '+1234567895', 
                    password: 'admin123',
                    lastLogin: '2024-01-13 09:15:00', 
                    status: 'active',
                    createdAt: '2024-01-01'
                }
            ];

            // Demo meetings
            appState.meetings = [
                { id: 1, title: 'Loan Consultation', department: 'Loan Department', date: '2024-01-15', time: '10:00', location: 'Conference Room A', duration: 1, description: 'Personal loan consultation session', maxAttendees: 10, status: 'active', createdAt: '2024-01-10', attendees: [] },
                { id: 2, title: 'Investment Seminar', department: 'Investment Banking', date: '2024-01-14', time: '14:00', location: 'Auditorium', duration: 2, description: 'Quarterly investment seminar', maxAttendees: 50, status: 'completed', createdAt: '2024-01-05', attendees: [] },
                { id: 3, title: 'Account Opening', department: 'Customer Service', date: '2024-01-16', time: '09:00', location: 'Service Desk 1', duration: 0.5, description: 'New account opening session', maxAttendees: 5, status: 'active', createdAt: '2024-01-12', attendees: [] },
                { id: 4, title: 'Mortgage Advice', department: 'Mortgage Services', date: '2024-01-17', time: '11:00', location: 'Room 201', duration: 1.5, description: 'Home mortgage consultation', maxAttendees: 8, status: 'active', createdAt: '2024-01-13', attendees: [] },
                { id: 5, title: 'Credit Card Workshop', department: 'Credit Card Division', date: '2024-01-18', time: '13:00', location: 'Training Room', duration: 2, description: 'Credit card benefits workshop', maxAttendees: 20, status: 'active', createdAt: '2024-01-14', attendees: [] }
            ];

            // Demo attendees
            appState.attendees = [
                { id: 1, name: 'Alice Johnson', email: 'alice@email.com', phone: '+1234567001', account: 'ACC001234', meetingId: 1, meetingTitle: 'Loan Consultation', meetingDate: '2024-01-15', meetingTime: '10:00', department: 'Loan Department', purpose: 'loan_consultation', notes: 'Interested in home loan', registrationDate: '2024-01-12 09:15:00' },
                { id: 2, name: 'Bob Smith', email: 'bob@email.com', phone: '+1234567002', account: 'ACC001235', meetingId: 2, meetingTitle: 'Investment Seminar', meetingDate: '2024-01-14', meetingTime: '14:00', department: 'Investment Banking', purpose: 'investment', notes: 'Retirement planning', registrationDate: '2024-01-11 14:30:00' },
                { id: 3, name: 'Charlie Brown', email: 'charlie@email.com', phone: '+1234567003', account: 'ACC001236', meetingId: 3, meetingTitle: 'Account Opening', meetingDate: '2024-01-16', meetingTime: '09:00', department: 'Customer Service', purpose: 'account_opening', notes: 'Opening business account', registrationDate: '2024-01-13 11:00:00' },
                { id: 4, name: 'Diana Prince', email: 'diana@email.com', phone: '+1234567004', account: 'ACC001237', meetingId: 1, meetingTitle: 'Loan Consultation', meetingDate: '2024-01-15', meetingTime: '10:00', department: 'Loan Department', purpose: 'loan_consultation', notes: 'Car loan inquiry', registrationDate: '2024-01-14 15:45:00' },
                { id: 5, name: 'Edward Wilson', email: 'edward@email.com', phone: '+1234567005', account: 'ACC001238', meetingId: 4, meetingTitle: 'Mortgage Advice', meetingDate: '2024-01-17', meetingTime: '11:00', department: 'Mortgage Services', purpose: 'mortgage', notes: 'First-time home buyer', registrationDate: '2024-01-14 10:30:00' }
            ];

            // Link attendees to meetings
            appState.meetings[0].attendees = [appState.attendees[0], appState.attendees[3]];
            appState.meetings[1].attendees = [appState.attendees[1]];
            appState.meetings[2].attendees = [appState.attendees[2]];
            appState.meetings[3].attendees = [appState.attendees[4]];

            console.log("Demo data initialized");
            saveDataToLocalStorage();
        }

        function saveDataToLocalStorage() {
            localStorage.setItem('bankMeetingAdmins', JSON.stringify(appState.admins));
            localStorage.setItem('bankMeetingDepartments', JSON.stringify(appState.departments));
            localStorage.setItem('bankMeetingMeetings', JSON.stringify(appState.meetings));
            localStorage.setItem('bankMeetingAttendees', JSON.stringify(appState.attendees));
            console.log("Data saved to localStorage");
        }

        function loadDataFromLocalStorage() {
            console.log("Loading data from localStorage...");
            
            const savedAdmins = localStorage.getItem('bankMeetingAdmins');
            const savedDepartments = localStorage.getItem('bankMeetingDepartments');
            const savedMeetings = localStorage.getItem('bankMeetingMeetings');
            const savedAttendees = localStorage.getItem('bankMeetingAttendees');

            if (savedAdmins) {
                try {
                    appState.admins = JSON.parse(savedAdmins);
                    console.log(`Loaded ${appState.admins.length} admins`);
                } catch (e) {
                    console.error("Error parsing admins:", e);
                    appState.admins = [];
                }
            }
            
            if (savedDepartments) {
                try {
                    appState.departments = JSON.parse(savedDepartments);
                    console.log(`Loaded ${appState.departments.length} departments`);
                } catch (e) {
                    console.error("Error parsing departments:", e);
                    appState.departments = [];
                }
            }
            
            if (savedMeetings) {
                try {
                    appState.meetings = JSON.parse(savedMeetings);
                    console.log(`Loaded ${appState.meetings.length} meetings`);
                } catch (e) {
                    console.error("Error parsing meetings:", e);
                    appState.meetings = [];
                }
            }
            
            if (savedAttendees) {
                try {
                    appState.attendees = JSON.parse(savedAttendees);
                    console.log(`Loaded ${appState.attendees.length} attendees`);
                } catch (e) {
                    console.error("Error parsing attendees:", e);
                    appState.attendees = [];
                }
            }

            // If no data exists, initialize demo data
            if (appState.admins.length === 0 && appState.departments.length === 0 && 
                appState.meetings.length === 0 && appState.attendees.length === 0) {
                console.log("No data found, initializing demo data...");
                initializeDemoData();
            }
        }

        // ==================== SUPABASE DATA FUNCTIONS ====================
        async function saveMeetingsToSupabase() {
            if (!appState.supabaseConnected) return false;
            
            try {
                const meetingsData = appState.meetings.map(m => ({
                    title: m.title,
                    department: m.department,
                    meeting_date: m.date,
                    meeting_time: m.time,
                    location: m.location,
                    duration: m.duration,
                    description: m.description,
                    max_attendees: m.maxAttendees,
                    status: m.status,
                    created_by: appState.currentUser?.email,
                    created_at: m.createdAt || new Date().toISOString()
                }));
                
                const { data, error } = await supabase
                    .from('meetings')
                    .upsert(meetingsData, { onConflict: 'id' });
                
                if (error) throw error;
                console.log('Meetings saved to Supabase');
                return true;
            } catch (error) {
                console.error('Error saving meetings:', error);
                return false;
            }
        }

        async function saveAttendeesToSupabase() {
            if (!appState.supabaseConnected) return false;
            
            try {
                const attendeesData = appState.attendees.map(a => ({
                    name: a.name,
                    email: a.email,
                    phone: a.phone,
                    account_number: a.account,
                    meeting_id: a.meetingId,
                    meeting_title: a.meetingTitle,
                    meeting_date: a.meetingDate,
                    meeting_time: a.meetingTime,
                    department: a.department,
                    purpose: a.purpose,
                    notes: a.notes,
                    registration_date: a.registrationDate || new Date().toISOString()
                }));
                
                const { data, error } = await supabase
                    .from('attendees')
                    .upsert(attendeesData, { onConflict: 'id' });
                
                if (error) throw error;
                console.log('Attendees saved to Supabase');
                return true;
            } catch (error) {
                console.error('Error saving attendees:', error);
                return false;
            }
        }

        async function saveDepartmentsToSupabase() {
            if (!appState.supabaseConnected) return false;
            
            try {
                const departmentsData = appState.departments.map(d => ({
                    name: d.name,
                    head: d.head,
                    email: d.email,
                    phone: d.phone,
                    description: d.description,
                    created_at: d.createdAt || new Date().toISOString()
                }));
                
                const { data, error } = await supabase
                    .from('departments')
                    .upsert(departmentsData, { onConflict: 'id' });
                
                if (error) throw error;
                console.log('Departments saved to Supabase');
                return true;
            } catch (error) {
                console.error('Error saving departments:', error);
                return false;
            }
        }

        async function saveAdminsToSupabase() {
            if (!appState.supabaseConnected) return false;
            
            try {
                const adminsData = appState.admins.map(a => ({
                    name: a.name,
                    email: a.email,
                    department: a.department,
                    role: a.role,
                    phone: a.phone,
                    password: a.password,
                    last_login: a.lastLogin,
                    status: a.status,
                    created_at: a.createdAt || new Date().toISOString()
                }));
                
                const { data, error } = await supabase
                    .from('admins')
                    .upsert(adminsData, { onConflict: 'id' });
                
                if (error) throw error;
                console.log('Admins saved to Supabase');
                return true;
            } catch (error) {
                console.error('Error saving admins:', error);
                return false;
            }
        }

        async function loadMeetingsFromSupabase() {
            if (!appState.supabaseConnected) return false;
            
            try {
                const { data, error } = await supabase
                    .from('meetings')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                appState.meetings = data.map(m => ({
                    id: m.id,
                    title: m.title,
                    department: m.department,
                    date: m.meeting_date,
                    time: m.meeting_time,
                    location: m.location,
                    duration: m.duration,
                    description: m.description,
                    maxAttendees: m.max_attendees,
                    status: m.status,
                    createdAt: m.created_at,
                    attendees: []
                }));
                
                console.log(`Loaded ${appState.meetings.length} meetings from Supabase`);
                return true;
            } catch (error) {
                console.error('Error loading meetings:', error);
                return false;
            }
        }

        async function loadAttendeesFromSupabase() {
            if (!appState.supabaseConnected) return false;
            
            try {
                const { data, error } = await supabase
                    .from('attendees')
                    .select('*')
                    .order('registration_date', { ascending: false });
                
                if (error) throw error;
                
                appState.attendees = data.map(a => ({
                    id: a.id,
                    name: a.name,
                    email: a.email,
                    phone: a.phone,
                    account: a.account_number,
                    meetingId: a.meeting_id,
                    meetingTitle: a.meeting_title,
                    meetingDate: a.meeting_date,
                    meetingTime: a.meeting_time,
                    department: a.department,
                    purpose: a.purpose,
                    notes: a.notes,
                    registrationDate: a.registration_date
                }));
                
                console.log(`Loaded ${appState.attendees.length} attendees from Supabase`);
                return true;
            } catch (error) {
                console.error('Error loading attendees:', error);
                return false;
            }
        }

        async function loadDepartmentsFromSupabase() {
            if (!appState.supabaseConnected) return false;
            
            try {
                const { data, error } = await supabase
                    .from('departments')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                appState.departments = data.map(d => ({
                    id: d.id,
                    name: d.name,
                    head: d.head,
                    email: d.email,
                    phone: d.phone,
                    description: d.description,
                    createdAt: d.created_at
                }));
                
                console.log(`Loaded ${appState.departments.length} departments from Supabase`);
                return true;
            } catch (error) {
                console.error('Error loading departments:', error);
                return false;
            }
        }

        async function loadAdminsFromSupabase() {
            if (!appState.supabaseConnected) return false;
            
            try {
                const { data, error } = await supabase
                    .from('admins')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                appState.admins = data.map(a => ({
                    id: a.id,
                    name: a.name,
                    email: a.email,
                    department: a.department,
                    role: a.role,
                    phone: a.phone,
                    password: a.password,
                    lastLogin: a.last_login,
                    status: a.status,
                    createdAt: a.created_at
                }));
                
                console.log(`Loaded ${appState.admins.length} admins from Supabase`);
                return true;
            } catch (error) {
                console.error('Error loading admins:', error);
                return false;
            }
        }

        // ==================== SYNC FUNCTIONS ====================
        async function syncAllToSupabase() {
            if (!appState.supabaseConnected) {
                showAlert('Not connected to Supabase', 'error');
                return false;
            }
            
            updateServerStatus('syncing');
            
            try {
                const results = await Promise.allSettled([
                    saveMeetingsToSupabase(),
                    saveAttendeesToSupabase(),
                    saveDepartmentsToSupabase(),
                    saveAdminsToSupabase()
                ]);
                
                const success = results.every(r => r.status === 'fulfilled' && r.value === true);
                
                if (success) {
                    updateServerStatus(true);
                    showAlert('All data synchronized with Supabase!', 'success');
                    return true;
                } else {
                    updateServerStatus(false);
                    showAlert('Some data failed to sync. Please check connection.', 'error');
                    return false;
                }
            } catch (error) {
                console.error('Sync error:', error);
                updateServerStatus(false);
                showAlert('Sync failed: ' + error.message, 'error');
                return false;
            }
        }

        async function loadAllFromSupabase() {
            if (!appState.supabaseConnected) {
                showAlert('Not connected to Supabase', 'error');
                return false;
            }
            
            updateServerStatus('syncing');
            
            try {
                const results = await Promise.allSettled([
                    loadMeetingsFromSupabase(),
                    loadAttendeesFromSupabase(),
                    loadDepartmentsFromSupabase(),
                    loadAdminsFromSupabase()
                ]);
                
                const success = results.every(r => r.status === 'fulfilled' && r.value === true);
                
                if (success) {
                    saveDataToLocalStorage();
                    updateAllData();
                    updateServerStatus(true);
                    showAlert('All data loaded from Supabase!', 'success');
                    return true;
                } else {
                    updateServerStatus(false);
                    showAlert('Failed to load some data. Using local storage.', 'error');
                    return false;
                }
            } catch (error) {
                console.error('Load error:', error);
                updateServerStatus(false);
                showAlert('Load failed: ' + error.message, 'error');
                return false;
            }
        }

        // ==================== BACKUP & RESTORE ====================
        async function backupToSupabaseStorage() {
            if (!appState.supabaseConnected) {
                showAlert('Not connected to Supabase', 'error');
                return false;
            }
            
            try {
                const backupData = {
                    backup_date: new Date().toISOString(),
                    version: '2.0',
                    meetings: appState.meetings,
                    attendees: appState.attendees,
                    departments: appState.departments,
                    admins: appState.admins
                };
                
                const jsonString = JSON.stringify(backupData, null, 2);
                const fileName = `backup_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;
                
                // Upload to Supabase Storage
                const { data, error } = await supabase.storage
                    .from('backups')
                    .upload(fileName, jsonString, {
                        contentType: 'application/json',
                        upsert: true
                    });
                
                if (error) throw error;
                
                showAlert(`Backup created successfully: ${fileName}`, 'success');
                updateBackupHistory();
                return true;
                
            } catch (error) {
                console.error('Backup error:', error);
                showAlert(`Backup failed: ${error.message}`, 'error');
                return false;
            }
        }

        async function listBackups() {
            if (!appState.supabaseConnected) return [];
            
            try {
                const { data, error } = await supabase.storage
                    .from('backups')
                    .list();
                
                if (error) throw error;
                
                return data
                    .filter(file => file.name.endsWith('.json'))
                    .sort((a, b) => b.created_at.localeCompare(a.created_at));
                
            } catch (error) {
                console.error('List backups error:', error);
                return [];
            }
        }

        async function restoreFromBackup(fileName) {
            if (!appState.supabaseConnected) {
                showAlert('Not connected to Supabase', 'error');
                return false;
            }
            
            try {
                // Download backup file
                const { data, error } = await supabase.storage
                    .from('backups')
                    .download(fileName);
                
                if (error) throw error;
                
                // Parse backup data
                const jsonString = await data.text();
                const backupData = JSON.parse(jsonString);
                
                // Restore to local storage
                if (backupData.meetings) {
                    appState.meetings = backupData.meetings;
                    localStorage.setItem('bankMeetingMeetings', JSON.stringify(backupData.meetings));
                }
                if (backupData.attendees) {
                    appState.attendees = backupData.attendees;
                    localStorage.setItem('bankMeetingAttendees', JSON.stringify(backupData.attendees));
                }
                if (backupData.departments) {
                    appState.departments = backupData.departments;
                    localStorage.setItem('bankMeetingDepartments', JSON.stringify(backupData.departments));
                }
                if (backupData.admins) {
                    appState.admins = backupData.admins;
                    localStorage.setItem('bankMeetingAdmins', JSON.stringify(backupData.admins));
                }
                
                updateAllData();
                showSuccessModal(`Successfully restored backup from ${fileName}`);
                return true;
                
            } catch (error) {
                console.error('Restore error:', error);
                showAlert(`Restore failed: ${error.message}`, 'error');
                return false;
            }
        }

        async function updateBackupHistory() {
            const backups = await listBackups();
            const historyList = document.getElementById('backup-history-list');
            
            if (historyList) {
                if (backups.length === 0) {
                    historyList.innerHTML = '<p style="color: #999; text-align: center;">No backups found</p>';
                    return;
                }
                
                historyList.innerHTML = backups.slice(0, 5).map(backup => `
                    <div class="backup-item">
                        <div class="backup-info">
                            <div class="backup-name">${backup.name}</div>
                            <div class="backup-meta">
                                ${new Date(backup.created_at).toLocaleString()} | 
                                ${formatFileSize(backup.metadata?.size || 0)}
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary restore-backup-btn" data-file="${backup.name}">
                            <i class="fas fa-redo"></i> Restore
                        </button>
                    </div>
                `).join('');
                
                // Add event listeners for restore buttons
                document.querySelectorAll('.restore-backup-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const fileName = this.getAttribute('data-file');
                        showConfirmation(
                            'Restore Backup',
                            `Are you sure you want to restore from "${fileName}"? This will replace ALL current data.`,
                            async () => {
                                await restoreFromBackup(fileName);
                            },
                            'warning'
                        );
                    });
                });
            }
        }

        // ==================== CSV IMPORT/EXPORT ====================
        async function importCSVToSupabase(csvText, tableName) {
            if (!appState.supabaseConnected) {
                showAlert('Not connected to Supabase', 'error');
                return { success: false, error: 'Not connected to Supabase' };
            }
            
            try {
                // Parse CSV
                const rows = csvText.split('\n').filter(row => row.trim());
                if (rows.length < 2) {
                    return { success: false, error: 'CSV file is empty or has no data' };
                }
                
                const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                const data = rows.slice(1).map(row => {
                    if (!row.trim()) return null;
                    const values = row.split(',').map(v => v.trim().replace(/"/g, ''));
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = values[index] || '';
                    });
                    return obj;
                }).filter(item => item !== null);
                
                if (data.length === 0) {
                    return { success: false, error: 'No valid data found in CSV' };
                }
                
                // Insert into Supabase
                const { error } = await supabase
                    .from(tableName)
                    .upsert(data, { onConflict: 'id' });
                
                if (error) throw error;
                
                return { success: true, count: data.length };
            } catch (error) {
                console.error('CSV import error:', error);
                return { success: false, error: error.message };
            }
        }

        async function exportSupabaseToCSV(tableName, fileName) {
            if (!appState.supabaseConnected) {
                showAlert('Not connected to Supabase', 'error');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from(tableName)
                    .select('*');
                
                if (error) throw error;
                
                if (!data || data.length === 0) {
                    showAlert(`No data found in ${tableName}`, 'error');
                    return;
                }
                
                // Convert to CSV
                const headers = Object.keys(data[0]);
                const csvRows = [
                    headers.join(','),
                    ...data.map(row => 
                        headers.map(header => 
                            JSON.stringify(row[header] || '')
                        ).join(',')
                    )
                ];
                
                const csvString = csvRows.join('\n');
                const blob = new Blob([csvString], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                
                // Create download link
                const link = document.createElement('a');
                link.href = url;
                link.download = `${fileName}_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showAlert(`Exported ${data.length} records to CSV`, 'success');
                
            } catch (error) {
                console.error('Export error:', error);
                showAlert(`Export failed: ${error.message}`, 'error');
            }
        }

        function exportAllAttendeesCSV() {
            const savedAttendees = JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]');
            
            if (savedAttendees.length === 0) {
                showAlert('No attendees to export', 'error');
                return;
            }
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Name,Email,Phone,Account Number,Meeting,Meeting Date,Department,Purpose,Registration Date,Notes\n";
            
            savedAttendees.forEach(attendee => {
                const purposeText = {
                    'loan_consultation': 'Loan Consultation',
                    'account_opening': 'Account Opening',
                    'investment': 'Investment',
                    'business': 'Business',
                    'mortgage': 'Mortgage Inquiry',
                    'credit_card': 'Credit Card Application',
                    'other': 'Other'
                }[attendee.purpose] || attendee.purpose;
                
                const row = [
                    `"${attendee.name}"`,
                    `"${attendee.email}"`,
                    `"${attendee.phone}"`,
                    `"${attendee.account || ''}"`,
                    `"${attendee.meetingTitle || attendee.meeting || ''}"`,
                    `"${attendee.meetingDate || ''}"`,
                    `"${attendee.departmentName || attendee.department || ''}"`,
                    `"${purposeText}"`,
                    `"${attendee.registrationDate}"`,
                    `"${attendee.notes || ''}"`
                ].join(',');
                
                csvContent += row + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            const fileName = `bank_meeting_attendees_${new Date().toISOString().split('T')[0]}.csv`;
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert(`Exported ${savedAttendees.length} attendees`, 'success');
        }

        // ==================== UTILITY FUNCTIONS ====================
        function updateServerStatus(connected) {
            const serverStatus = document.getElementById('server-status');
            const serverStatusText = document.getElementById('server-status-text');
            const statServer = document.getElementById('stat-server');
            
            if (connected === 'syncing') {
                serverStatus.className = 'server-status syncing';
                serverStatusText.innerHTML = '<span class="spinner"></span> Server: Syncing...';
                if (statServer) statServer.textContent = 'Syncing';
            } else if (connected) {
                serverStatus.className = 'server-status connected';
                serverStatusText.textContent = 'Server: Connected';
                if (statServer) statServer.textContent = 'Online';
                appState.supabaseConnected = true;
            } else {
                serverStatus.className = 'server-status disconnected';
                serverStatusText.textContent = 'Server: Disconnected';
                if (statServer) statServer.textContent = 'Offline';
                appState.supabaseConnected = false;
            }
        }

        function showRealtimeNotification(notification) {
            const notificationDiv = document.createElement('div');
            notificationDiv.className = 'real-time-notification';
            notificationDiv.innerHTML = `
                <i class="fas fa-${notification.type === 'new_registration' ? 'user-plus' : 'calendar-check'}"></i>
                <div class="real-time-notification-content">
                    <strong>${notification.title}</strong>
                    <p>${notification.message}</p>
                    <div class="real-time-notification-time">
                        ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                    </div>
                </div>
                <i class="fas fa-times close-notification" style="cursor: pointer;"></i>
            `;
            
            // Remove existing notifications
            const existing = document.querySelectorAll('.real-time-notification');
            existing.forEach(n => n.remove());
            
            // Add to body
            document.body.appendChild(notificationDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notificationDiv.parentNode) {
                    notificationDiv.style.animation = 'fadeOut 0.3s ease-out';
                    setTimeout(() => notificationDiv.remove(), 300);
                }
            }, 5000);
            
            // Close button
            notificationDiv.querySelector('.close-notification').addEventListener('click', () => {
                notificationDiv.remove();
            });
        }

        function showLiveCounter(count) {
            let counterDiv = document.getElementById('live-registration-counter');
            
            if (!counterDiv) {
                counterDiv = document.createElement('div');
                counterDiv.id = 'live-registration-counter';
                counterDiv.className = 'live-registration-counter';
                document.body.appendChild(counterDiv);
            }
            
            counterDiv.innerHTML = `
                <i class="fas fa-users"></i>
                <span>Today's Registrations: <strong>${count}</strong></span>
            `;
        }

        async function updateLiveRegistrationCounter() {
            if (!appState.supabaseConnected) return;
            
            try {
                const today = new Date().toISOString().split('T')[0];
                const { data, error } = await supabase
                    .from('attendees')
                    .select('count')
                    .gte('registration_date', today);
                
                if (!error && data) {
                    const count = data[0]?.count || 0;
                    showLiveCounter(count);
                }
            } catch (error) {
                console.error('Error updating live counter:', error);
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alert-container');
            if (alertContainer) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    ${message}
                `;
                alertContainer.innerHTML = '';
                alertContainer.appendChild(alertDiv);
                alertDiv.style.display = 'block';
                
                setTimeout(() => {
                    alertDiv.style.display = 'none';
                }, 5000);
            }
        }

        function showLoginAlert(message) {
            const loginAlert = document.getElementById('login-alert');
            if (loginAlert) {
                loginAlert.textContent = message;
                loginAlert.style.display = 'block';
                loginAlert.className = 'alert alert-error';
                
                setTimeout(() => {
                    loginAlert.style.display = 'none';
                }, 5000);
            }
        }

        function showConfirmation(title, message, onConfirm, iconType = 'warning') {
            appState.pendingAction = onConfirm;
            
            const confirmationModal = document.getElementById('confirmation-modal');
            const confirmationTitle = document.getElementById('confirmation-title');
            const confirmationMessage = document.getElementById('confirmation-message');
            const confirmationIcon = document.getElementById('confirmation-icon');
            
            if (confirmationModal && confirmationTitle && confirmationMessage && confirmationIcon) {
                confirmationTitle.textContent = title;
                confirmationMessage.textContent = message;
                confirmationIcon.className = `confirmation-icon ${iconType}`;
                
                const icon = confirmationIcon.querySelector('i');
                if (icon) {
                    if (iconType === 'warning') {
                        icon.className = 'fas fa-exclamation-triangle';
                    } else if (iconType === 'danger') {
                        icon.className = 'fas fa-trash-alt';
                    } else if (iconType === 'info') {
                        icon.className = 'fas fa-info-circle';
                    }
                }
                
                confirmationModal.classList.remove('hidden');
            }
        }

        function showSuccessModal(message) {
            const successModal = document.getElementById('success-modal');
            const successMessage = document.getElementById('success-message-text');
            
            if (successModal && successMessage) {
                successMessage.textContent = message;
                successModal.classList.remove('hidden');
            }
        }

        // ==================== UI UPDATE FUNCTIONS ====================
        function updateAllData() {
            console.log("Updating all data...");
            loadDataFromLocalStorage();
            updateStats();
            updateDashboard();
            updateMeetingsPage();
            updateAttendeesPage();
            updateDepartmentsPage();
            updateAdminsPage();
            updateServerStats();
            initializeCharts();
        }

        function updateStats() {
            const statMeetings = document.getElementById('stat-meetings');
            const statAttendees = document.getElementById('stat-attendees');
            const statDepartments = document.getElementById('stat-departments');
            
            if (!statMeetings || !statAttendees || !statDepartments) return;
            
            const activeMeetings = appState.meetings.filter(m => m.status === 'active').length;
            const totalAttendees = appState.attendees.length;
            const totalDepartments = appState.departments.length;
            
            statMeetings.textContent = activeMeetings;
            statAttendees.textContent = totalAttendees;
            statDepartments.textContent = totalDepartments;
        }

        function updateServerStats() {
            const dataStatus = document.getElementById('data-status');
            if (dataStatus) {
                const meetingsCount = appState.meetings.length;
                const attendeesCount = appState.attendees.length;
                const departmentsCount = appState.departments.length;
                const adminsCount = appState.admins.length;
                
                dataStatus.innerHTML = `
                    <strong>Local Storage Data:</strong><br>
                     Meetings: ${meetingsCount}<br>
                     Attendees: ${attendeesCount}<br>
                     Departments: ${departmentsCount}<br>
                     Admins: ${adminsCount}<br>
                    <br>
                    <strong>Last Updated:</strong> ${new Date().toLocaleString()}
                `;
            }
            
            updateBackupHistory();
        }

        // ==================== NAVIGATION FUNCTIONS ====================
        function initializeDashboard() {
            console.log('Initializing dashboard...');
            
            // Update admin email display
            const adminEmailSpan = document.getElementById('current-admin-email');
            if (adminEmailSpan && appState.currentUser) {
                adminEmailSpan.textContent = appState.currentUser.email;
            }
            
            // Update stats
            updateAllData();
            
            // Setup navigation
            setupNavigation();
            
            // Setup modals
            setupModals();
            
            console.log('Dashboard initialized');
        }

        function setupNavigation() {
            // Navigation items
            const navItems = document.querySelectorAll('.nav-item[data-page]');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const pageName = this.getAttribute('data-page');
                    
                    // Handle logout separately
                    if (this.id === 'logout-btn') {
                        showConfirmation(
                            'Logout',
                            'Are you sure you want to logout?',
                            function() {
                                simpleLogout();
                                document.getElementById('dashboard-page').classList.remove('active');
                                document.getElementById('login-page').classList.add('active');
                                showAlert('Logged out successfully', 'success');
                            },
                            'warning'
                        );
                        return;
                    }
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update page title
                    const pageTitle = document.getElementById('page-title');
                    if (pageTitle) {
                        pageTitle.textContent = this.querySelector('span').textContent;
                    }
                    
                    // Show selected page content
                    const allPages = document.querySelectorAll('.page-content');
                    allPages.forEach(page => page.classList.add('hidden'));
                    
                    const selectedPage = document.getElementById(pageName + '-content');
                    if (selectedPage) {
                        selectedPage.classList.remove('hidden');
                    }
                });
            });
            
            // Tab navigation
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab button
                    const parent = this.closest('.tab-nav');
                    parent.querySelectorAll('.tab-btn').forEach(tb => tb.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show selected tab content
                    const tabContents = this.closest('.content-card').querySelectorAll('.tab-content');
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    const selectedTab = document.getElementById(tabName);
                    if (selectedTab) {
                        selectedTab.classList.add('active');
                    }
                });
            });
        }

        function setupModals() {
            // Close modal buttons
            const closeButtons = document.querySelectorAll('.close-modal');
            closeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                });
            });
            
            // Confirmation modal buttons
            const confirmCancel = document.getElementById('confirm-cancel');
            const confirmOk = document.getElementById('confirm-ok');
            const successOk = document.getElementById('success-ok');
            
            if (confirmCancel) {
                confirmCancel.addEventListener('click', function() {
                    document.getElementById('confirmation-modal').classList.add('hidden');
                    appState.pendingAction = null;
                });
            }
            
            if (confirmOk) {
                confirmOk.addEventListener('click', function() {
                    document.getElementById('confirmation-modal').classList.add('hidden');
                    if (appState.pendingAction) {
                        appState.pendingAction();
                        appState.pendingAction = null;
                    }
                });
            }
            
            if (successOk) {
                successOk.addEventListener('click', function() {
                    document.getElementById('success-modal').classList.add('hidden');
                });
            }
            
            // Close modals when clicking outside
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            });
        }

        function updateDashboard() {
            // Update recent meetings table
            const recentMeetingsTable = document.getElementById('recent-meetings-table');
            if (recentMeetingsTable) {
                const recentMeetings = appState.meetings.slice(0, 5); // Get 5 most recent
                
                recentMeetingsTable.innerHTML = recentMeetings.map(meeting => {
                    const attendeeCount = appState.attendees.filter(a => a.meetingId === meeting.id).length;
                    const maxAttendees = meeting.maxAttendees || 'Unlimited';
                    
                    return `
                        <tr>
                            <td><strong>${meeting.title}</strong></td>
                            <td>${meeting.date} at ${meeting.time}</td>
                            <td>${meeting.department}</td>
                            <td>${attendeeCount} / ${maxAttendees}</td>
                            <td><span class="status ${meeting.status}">${meeting.status}</span></td>
                            <td>
                                <button class="btn btn-sm btn-primary view-meeting-btn" data-id="${meeting.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
                
                // Add event listeners to view buttons
                document.querySelectorAll('.view-meeting-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const meetingId = parseInt(this.getAttribute('data-id'));
                        showMeetingDetails(meetingId);
                    });
                });
            }
        }

        function updateMeetingsPage() {
            // Update active meetings table
            const activeMeetingsTable = document.getElementById('active-meetings-table');
            if (activeMeetingsTable) {
                const activeMeetings = appState.meetings.filter(m => m.status === 'active');
                
                activeMeetingsTable.innerHTML = activeMeetings.map(meeting => {
                    const attendeeCount = appState.attendees.filter(a => a.meetingId === meeting.id).length;
                    const maxAttendees = meeting.maxAttendees || 'Unlimited';
                    
                    return `
                        <tr>
                            <td><strong>${meeting.title}</strong></td>
                            <td>${meeting.date} at ${meeting.time}</td>
                            <td>${meeting.department}</td>
                            <td>${meeting.location}</td>
                            <td>${attendeeCount} / ${maxAttendees}</td>
                            <td>
                                <button class="btn btn-sm btn-warning generate-qr-btn" data-id="${meeting.id}">
                                    <i class="fas fa-qrcode"></i> QR
                                </button>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-primary view-meeting-btn-2" data-id="${meeting.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-secondary edit-meeting-btn" data-id="${meeting.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-meeting-btn" data-id="${meeting.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update past meetings table
            const pastMeetingsTable = document.getElementById('past-meetings-table');
            if (pastMeetingsTable) {
                const pastMeetings = appState.meetings.filter(m => m.status !== 'active');
                
                pastMeetingsTable.innerHTML = pastMeetings.map(meeting => {
                    const attendeeCount = appState.attendees.filter(a => a.meetingId === meeting.id).length;
                    const maxAttendees = meeting.maxAttendees || 'Unlimited';
                    
                    return `
                        <tr>
                            <td><strong>${meeting.title}</strong></td>
                            <td>${meeting.date} at ${meeting.time}</td>
                            <td>${meeting.department}</td>
                            <td>${meeting.location}</td>
                            <td>${attendeeCount} / ${maxAttendees}</td>
                            <td><span class="status ${meeting.status}">${meeting.status}</span></td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update department dropdown in meeting form
            const meetingDepartmentSelect = document.getElementById('meeting-department');
            if (meetingDepartmentSelect) {
                meetingDepartmentSelect.innerHTML = `
                    <option value="">Select Department</option>
                    ${appState.departments.map(dept => `
                        <option value="${dept.name}">${dept.name}</option>
                    `).join('')}
                `;
            }
        }

        function updateAttendeesPage() {
            // Update attendees table
            const attendeesTable = document.getElementById('attendees-table');
            if (attendeesTable) {
                attendeesTable.innerHTML = appState.attendees.map(attendee => {
                    const purposeText = {
                        'loan_consultation': 'Loan Consultation',
                        'account_opening': 'Account Opening',
                        'investment': 'Investment',
                        'business': 'Business Banking',
                        'mortgage': 'Mortgage Inquiry',
                        'credit_card': 'Credit Card Application',
                        'other': 'Other'
                    }[attendee.purpose] || attendee.purpose;
                    
                    return `
                        <tr>
                            <td><strong>${attendee.name}</strong></td>
                            <td>${attendee.email}</td>
                            <td>${attendee.phone}</td>
                            <td>${attendee.account || 'N/A'}</td>
                            <td>${attendee.meetingTitle}</td>
                            <td>${attendee.meetingDate}</td>
                            <td>${attendee.department}</td>
                            <td>${attendee.registrationDate || 'N/A'}</td>
                            <td>
                                <button class="btn btn-sm btn-primary view-attendee-btn" data-id="${attendee.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-attendee-btn" data-id="${attendee.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update meetings summary
            const meetingsSummary = document.getElementById('meetings-summary');
            if (meetingsSummary) {
                const meetingCounts = {};
                appState.attendees.forEach(attendee => {
                    const meetingTitle = attendee.meetingTitle;
                    if (meetingTitle) {
                        meetingCounts[meetingTitle] = (meetingCounts[meetingTitle] || 0) + 1;
                    }
                });
                
                meetingsSummary.innerHTML = Object.entries(meetingCounts).map(([meeting, count]) => `
                    <div class="meeting-summary-card">
                        <div>
                            <strong>${meeting}</strong>
                            <p>${count} attendee(s)</p>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateDepartmentsPage() {
            // Update departments table
            const departmentsTable = document.getElementById('departments-table');
            if (departmentsTable) {
                departmentsTable.innerHTML = appState.departments.map(dept => {
                    const meetingCount = appState.meetings.filter(m => m.department === dept.name).length;
                    const attendeeCount = appState.attendees.filter(a => a.department === dept.name).length;
                    
                    return `
                        <tr>
                            <td><strong>${dept.name}</strong></td>
                            <td>${dept.head}</td>
                            <td>${dept.email}</td>
                            <td>${meetingCount}</td>
                            <td>${attendeeCount}</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-department-btn" data-id="${dept.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-department-btn" data-id="${dept.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function updateAdminsPage() {
            // Update admins table
            const adminsTable = document.getElementById('admins-table');
            if (adminsTable) {
                adminsTable.innerHTML = appState.admins.map(admin => {
                    return `
                        <tr>
                            <td><strong>${admin.name}</strong></td>
                            <td>${admin.email}</td>
                            <td>${admin.department}</td>
                            <td><span class="badge badge-${admin.role === 'super_admin' ? 'warning' : 'success'}">${admin.role}</span></td>
                            <td>${admin.lastLogin || 'Never'}</td>
                            <td><span class="status active">${admin.status}</span></td>
                            <td>
                                <button class="btn btn-sm btn-danger delete-admin-btn" data-id="${admin.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update department dropdown in admin form
            const adminDepartmentSelect = document.getElementById('admin-department');
            if (adminDepartmentSelect) {
                adminDepartmentSelect.innerHTML = `
                    <option value="">Select Department</option>
                    ${appState.departments.map(dept => `
                        <option value="${dept.name}">${dept.name}</option>
                    `).join('')}
                `;
            }
        }

        function initializeCharts() {
            try {
                // Attendance Chart
                const attendanceCtx = document.getElementById('attendanceChart')?.getContext('2d');
                if (attendanceCtx && appState.charts.attendance) {
                    appState.charts.attendance.destroy();
                }
                
                if (attendanceCtx) {
                    // Group attendees by meeting
                    const meetingAttendance = {};
                    appState.attendees.forEach(attendee => {
                        const meetingTitle = attendee.meetingTitle;
                        if (meetingTitle) {
                            meetingAttendance[meetingTitle] = (meetingAttendance[meetingTitle] || 0) + 1;
                        }
                    });
                    
                    const meetings = Object.keys(meetingAttendance);
                    const attendanceCounts = Object.values(meetingAttendance);
                    
                    appState.charts.attendance = new Chart(attendanceCtx, {
                        type: 'bar',
                        data: {
                            labels: meetings,
                            datasets: [{
                                label: 'Number of Attendees',
                                data: attendanceCounts,
                                backgroundColor: 'rgba(255, 219, 88, 0.7)',
                                borderColor: 'rgba(255, 219, 88, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: {
                                        color: '#fff'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#fff'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                },
                                x: {
                                    ticks: {
                                        color: '#fff'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Department Distribution Chart
                const departmentCtx = document.getElementById('departmentChart')?.getContext('2d');
                if (departmentCtx && appState.charts.department) {
                    appState.charts.department.destroy();
                }
                
                if (departmentCtx) {
                    // Group attendees by department
                    const departmentCounts = {};
                    appState.attendees.forEach(attendee => {
                        const department = attendee.department;
                        if (department) {
                            departmentCounts[department] = (departmentCounts[department] || 0) + 1;
                        }
                    });
                    
                    const departments = Object.keys(departmentCounts);
                    const counts = Object.values(departmentCounts);
                    
                    // Generate colors
                    const colors = [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(153, 102, 255, 0.7)',
                        'rgba(255, 159, 64, 0.7)'
                    ];
                    
                    appState.charts.department = new Chart(departmentCtx, {
                        type: 'pie',
                        data: {
                            labels: departments,
                            datasets: [{
                                label: 'Attendees by Department',
                                data: counts,
                                backgroundColor: colors,
                                borderColor: colors.map(c => c.replace('0.7', '1')),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        color: '#fff'
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing charts:', error);
            }
        }

        function showMeetingDetails(meetingId) {
            const meeting = appState.meetings.find(m => m.id === meetingId);
            if (!meeting) return;
            
            const attendees = appState.attendees.filter(a => a.meetingId === meetingId);
            const attendeeCount = attendees.length;
            const maxAttendees = meeting.maxAttendees || 'Unlimited';
            
            const modalContent = document.getElementById('meeting-details-content');
            if (modalContent) {
                modalContent.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--mustard); margin-bottom: 10px;">${meeting.title}</h3>
                        <p style="color: #ccc;">${meeting.description || 'No description provided.'}</p>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date</label>
                            <p style="color: white;">${meeting.date}</p>
                        </div>
                        <div class="form-group">
                            <label>Time</label>
                            <p style="color: white;">${meeting.time}</p>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Department</label>
                            <p style="color: white;">${meeting.department}</p>
                        </div>
                        <div class="form-group">
                            <label>Location</label>
                            <p style="color: white;">${meeting.location}</p>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Duration</label>
                            <p style="color: white;">${meeting.duration} hour(s)</p>
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <p><span class="status ${meeting.status}">${meeting.status}</span></p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Attendance</label>
                        <p style="color: white;">${attendeeCount} / ${maxAttendees} attendees</p>
                    </div>
                    
                    ${attendees.length > 0 ? `
                        <div class="form-group">
                            <label>Attendee List</label>
                            <div style="background: var(--light-gray); padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto;">
                                ${attendees.map(attendee => `
                                    <div style="padding: 5px 0; border-bottom: 1px solid var(--border-color);">
                                        <strong>${attendee.name}</strong> - ${attendee.email}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="header-actions" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="generate-qr-from-details" data-id="${meeting.id}">
                            <i class="fas fa-qrcode"></i> Generate QR Code
                        </button>
                        <button class="btn btn-secondary close-meeting-details">
                            Close
                        </button>
                    </div>
                `;
                
                // Add event listeners
                const generateQrBtn = document.getElementById('generate-qr-from-details');
                if (generateQrBtn) {
                    generateQrBtn.addEventListener('click', function() {
                        const meetingId = parseInt(this.getAttribute('data-id'));
                        showQrModal(meetingId);
                        document.getElementById('meeting-details-modal').classList.add('hidden');
                    });
                }
                
                const closeBtn = modalContent.querySelector('.close-meeting-details');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        document.getElementById('meeting-details-modal').classList.add('hidden');
                    });
                }
                
                // Show modal
                document.getElementById('meeting-details-modal').classList.remove('hidden');
            }
        }

        function showQrModal(meetingId) {
            const meeting = appState.meetings.find(m => m.id === meetingId);
            if (!meeting) return;
            
            // Update modal content
            document.getElementById('qr-meeting-title').textContent = meeting.title;
            document.getElementById('qr-meeting-date').textContent = meeting.date;
            document.getElementById('qr-meeting-time').textContent = meeting.time;
            document.getElementById('qr-meeting-location').textContent = meeting.location;
            
            // Generate registration URL
            const registrationUrl = `${window.location.origin}${window.location.pathname}#registration-${meetingId}`;
            document.getElementById('qr-meeting-link').textContent = registrationUrl;
            
            // Generate QR code
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            try {
                new QRCode(qrContainer, {
                    text: registrationUrl,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            } catch (error) {
                console.error('Error generating QR code:', error);
                qrContainer.innerHTML = '<p style="color: red;">Error generating QR code</p>';
            }
            
            // Add event listeners for buttons
            const downloadQrBtn = document.getElementById('download-qr-btn');
            if (downloadQrBtn) {
                downloadQrBtn.onclick = function() {
                    const canvas = qrContainer.querySelector('canvas');
                    if (canvas) {
                        const link = document.createElement('a');
                        link.download = `qr_${meeting.title.replace(/\s+/g, '_')}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                    }
                };
            }
            
            const copyLinkBtn = document.getElementById('copy-link-btn');
            if (copyLinkBtn) {
                copyLinkBtn.onclick = function() {
                    navigator.clipboard.writeText(registrationUrl)
                        .then(() => showAlert('Link copied to clipboard!', 'success'))
                        .catch(err => showAlert('Failed to copy link', 'error'));
                };
            }
            
            // Show modal
            document.getElementById('qr-modal').classList.remove('hidden');
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            console.log("Setting up event listeners...");
            
            // Initialize Supabase
            initializeSupabase();
            
            // Check for existing session
            const hasSession = checkExistingSession();
            
            // Login form
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    
                    // Use simple login system
                    const result = await simpleLogin(email, password);
                    
                    if (result.success) {
                        // Login successful
                        document.getElementById('login-page').classList.remove('active');
                        document.getElementById('dashboard-page').classList.add('active');
                        
                        // Update admin email display
                        const adminEmailSpan = document.getElementById('current-admin-email');
                        if (adminEmailSpan) {
                            adminEmailSpan.textContent = result.user.email;
                        }
                        
                        // Initialize dashboard
                        initializeDashboard();
                        
                        // Try to connect to Supabase in background
                        testSupabaseConnection().then(connected => {
                            if (connected) {
                                initializeRealtimeUpdates();
                                showAlert('Connected to Supabase!', 'success');
                            }
                        });
                        
                        showAlert(`Welcome back, ${result.user.name}!`, 'success');
                    } else {
                        // Login failed
                        showLoginAlert(result.error || 'Invalid credentials');
                    }
                });
            }
            
            // Connect to Supabase button
            const connectBtn = document.getElementById('connect-server-btn');
            if (connectBtn) {
                connectBtn.addEventListener('click', async function() {
                    const success = await testSupabaseConnection();
                    if (success) {
                        showAlert('Connected to Supabase successfully!', 'success');
                        initializeRealtimeUpdates();
                    } else {
                        showAlert('Failed to connect to Supabase', 'error');
                    }
                });
            }
            
            // Sync to Supabase button
            const syncBtn = document.getElementById('sync-data-btn');
            if (syncBtn) {
                syncBtn.addEventListener('click', async function() {
                    await syncAllToSupabase();
                });
            }
            
            // Load from Supabase button
            const loadBtn = document.getElementById('load-from-server-btn');
            if (loadBtn) {
                loadBtn.addEventListener('click', async function() {
                    await loadAllFromSupabase();
                });
            }
            
            // Backup now button
            const backupBtn = document.getElementById('backup-now-btn');
            if (backupBtn) {
                backupBtn.addEventListener('click', async function() {
                    await backupToSupabaseStorage();
                });
            }
            
            // CSV import button
            const importCsvBtn = document.getElementById('import-csv-btn');
            const csvUpload = document.getElementById('csv-upload');
            const csvImportSection = document.getElementById('csv-import-section');
            const confirmCsvUpload = document.getElementById('confirm-csv-upload');
            const cancelCsvUpload = document.getElementById('cancel-csv-upload');
            
            if (importCsvBtn) {
                importCsvBtn.addEventListener('click', function() {
                    csvImportSection.classList.toggle('hidden');
                });
            }
            
            if (csvUpload) {
                csvUpload.addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const tableSelect = document.getElementById('csv-table-select');
                    const backupSelect = document.getElementById('csv-backup-first');
                    const tableName = tableSelect ? tableSelect.value : 'attendees';
                    const backupFirst = backupSelect ? backupSelect.value === 'yes' : true;
                    
                    if (backupFirst) {
                        await backupToSupabaseStorage();
                    }
                    
                    const reader = new FileReader();
                    reader.onload = async function(event) {
                        const csvText = event.target.result;
                        const result = await importCSVToSupabase(csvText, tableName);
                        
                        if (result.success) {
                            showAlert(`Successfully imported ${result.count} records from CSV`, 'success');
                            await loadAllFromSupabase();
                            csvImportSection.classList.add('hidden');
                            csvUpload.value = '';
                        } else {
                            showAlert(`Import failed: ${result.error}`, 'error');
                        }
                    };
                    reader.readAsText(file);
                });
            }
            
            if (confirmCsvUpload) {
                confirmCsvUpload.addEventListener('click', function() {
                    csvUpload.click();
                });
            }
            
            if (cancelCsvUpload) {
                cancelCsvUpload.addEventListener('click', function() {
                    csvImportSection.classList.add('hidden');
                    csvUpload.value = '';
                });
            }
            
            // Export buttons
            const exportAllCsvBtn = document.getElementById('export-all-csv');
            if (exportAllCsvBtn) {
                exportAllCsvBtn.addEventListener('click', exportAllAttendeesCSV);
            }
            
            const exportMeetingsCsvBtn = document.getElementById('export-meetings-csv');
            if (exportMeetingsCsvBtn) {
                exportMeetingsCsvBtn.addEventListener('click', function() {
                    exportSupabaseToCSV('meetings', 'meetings');
                });
            }
            
            const exportAttendeesBtn = document.getElementById('export-server-attendees-2');
            if (exportAttendeesBtn) {
                exportAttendeesBtn.addEventListener('click', function() {
                    exportSupabaseToCSV('attendees', 'attendees');
                });
            }
            
            // Backup to JSON button
            const backupJsonBtn = document.getElementById('backup-json');
            if (backupJsonBtn) {
                backupJsonBtn.addEventListener('click', function() {
                    const data = {
                        backupDate: new Date().toISOString(),
                        version: '1.0',
                        meetings: JSON.parse(localStorage.getItem('bankMeetingMeetings') || '[]'),
                        attendees: JSON.parse(localStorage.getItem('bankMeetingAttendees') || '[]'),
                        departments: JSON.parse(localStorage.getItem('bankMeetingDepartments') || '[]'),
                        admins: JSON.parse(localStorage.getItem('bankMeetingAdmins') || '[]')
                    };
                    
                    const jsonString = JSON.stringify(data, null, 2);
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    
                    link.href = url;
                    link.download = `bank_meeting_backup_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    setTimeout(() => URL.revokeObjectURL(url), 100);
                    showAlert('All data backed up to JSON file!', 'success');
                });
            }
            
            // Backup to Supabase Storage button
            const backupServerBtn = document.getElementById('backup-server');
            if (backupServerBtn) {
                backupServerBtn.addEventListener('click', async function() {
                    await backupToSupabaseStorage();
                });
            }
            
            // Sync all data button
            const syncAllBtn = document.getElementById('sync-all-data');
            if (syncAllBtn) {
                syncAllBtn.addEventListener('click', async function() {
                    await syncAllToSupabase();
                });
            }
            
            // Load all from Supabase button
            const loadAllBtn = document.getElementById('load-all-server');
            if (loadAllBtn) {
                loadAllBtn.addEventListener('click', async function() {
                    await loadAllFromSupabase();
                });
            }
            
            // Clear local data button
            const clearLocalBtn = document.getElementById('clear-local-data');
            if (clearLocalBtn) {
                clearLocalBtn.addEventListener('click', function() {
                    showConfirmation(
                        'Clear Local Data',
                        'Are you sure you want to clear ALL local data? This cannot be undone!',
                        function() {
                            localStorage.clear();
                            location.reload();
                        },
                        'danger'
                    );
                });
            }
            
            // Auto-sync and auto-backup selectors
            const autoSyncSelect = document.getElementById('auto-sync');
            const autoBackupSelect = document.getElementById('auto-backup-select');
            
            if (autoSyncSelect) {
                autoSyncSelect.addEventListener('change', function() {
                    const minutes = parseInt(this.value);
                    setupAutoSync(minutes);
                });
            }
            
            if (autoBackupSelect) {
                autoBackupSelect.addEventListener('change', function() {
                    const minutes = parseInt(this.value);
                    setupAutoBackup(minutes);
                });
            }
            
            // Initialize with saved values
            const savedAutoSync = localStorage.getItem('auto_sync') || 'off';
            const savedAutoBackup = localStorage.getItem('auto_backup') || '0';
            
            if (autoSyncSelect) autoSyncSelect.value = savedAutoSync;
            if (autoBackupSelect) autoBackupSelect.value = savedAutoBackup;
            
            setupAutoSync(savedAutoSync === 'off' ? 0 : parseInt(savedAutoSync));
            setupAutoBackup(parseInt(savedAutoBackup));
           
        }

        // ==================== AUTO SYNC & BACKUP ====================
        function setupAutoSync(intervalMinutes) {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
                autoSyncInterval = null;
            }
            
            if (intervalMinutes > 0) {
                const intervalMs = intervalMinutes * 60 * 1000;
                autoSyncInterval = setInterval(async () => {
                    if (appState.currentUser && appState.supabaseConnected) {
                        console.log(`Auto-sync running at ${new Date().toLocaleString()}`);
                        await syncAllToSupabase();
                    }
                }, intervalMs);
                
                localStorage.setItem('auto_sync', intervalMinutes.toString());
                console.log(`Auto-sync set to run every ${intervalMinutes} minutes`);
            } else {
                localStorage.setItem('auto_sync', 'off');
            }
        }

        function setupAutoBackup(intervalMinutes) {
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
                autoBackupInterval = null;
            }
            
            if (intervalMinutes > 0) {
                const intervalMs = intervalMinutes * 60 * 1000;
                autoBackupInterval = setInterval(async () => {
                    if (appState.currentUser && appState.supabaseConnected) {
                        console.log(`Auto-backup running at ${new Date().toLocaleString()}`);
                        await backupToSupabaseStorage();
                    }
                }, intervalMs);
                
                localStorage.setItem('auto_backup', intervalMinutes.toString());
                console.log(`Auto-backup set to run every ${intervalMinutes} minutes`);
            } else {
                localStorage.setItem('auto_backup', '0');
            }
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log("Bank Meeting System initialized with Supabase integration");
            
            // Load data from localStorage
            loadDataFromLocalStorage();
            
            // Initialize confirmation modal
            initializeConfirmationModal();
            
            // Setup event listeners
            setupEventListeners();
            
            // Check for registration in URL hash
            const hash = window.location.hash;
            if (hash && hash.startsWith('#registration-')) {
                const meetingId = parseInt(hash.replace('#registration-', ''));
                if (meetingId && !isNaN(meetingId)) {
                    document.getElementById('login-page').classList.remove('active');
                    document.getElementById('dashboard-page').classList.remove('active');
                    document.getElementById('registration-portal').style.display = 'block';
                    document.getElementById('registration-portal').classList.add('active');
                    // You would need to implement showRegistrationForm function
                }
            }
            
            // Check URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('registration') === 'true') {
                const meetingId = parseInt(urlParams.get('meeting'));
                if (meetingId) {
                    document.getElementById('login-page').classList.remove('active');
                    document.getElementById('dashboard-page').classList.remove('active');
                    document.getElementById('registration-portal').style.display = 'block';
                    document.getElementById('registration-portal').classList.add('active');
                    // You would need to implement showRegistrationForm function
                }
            }
            
            // Test Supabase connection on startup
            await testSupabaseConnection();
            
            // Initialize charts when page is fully loaded
            setTimeout(() => {
                if (appState.currentUser) {
                    initializeCharts();
                }
            }, 100);
        });

        function initializeConfirmationModal() {
            const confirmCancel = document.getElementById('confirm-cancel');
            const confirmOk = document.getElementById('confirm-ok');
            const successOk = document.getElementById('success-ok');
            
            if (confirmCancel) {
                confirmCancel.addEventListener('click', function() {
                    document.getElementById('confirmation-modal').classList.add('hidden');
                    appState.pendingAction = null;
                });
            }
            
            if (confirmOk) {
                confirmOk.addEventListener('click', function() {
                    document.getElementById('confirmation-modal').classList.add('hidden');
                    if (appState.pendingAction) {
                        appState.pendingAction();
                        appState.pendingAction = null;
                    }
                });
            }
            
            if (successOk) {
                successOk.addEventListener('click', function() {
                    document.getElementById('success-modal').classList.add('hidden');
                });
            }
        }
    </script>
</body>
</html>